
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Platform paper social experiment analysis: Part 2 &#8212; Aeon v0.0.19 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=9651da53" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=84fddc8a"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user/how_to/social_analysis2';</script>
    <script src="../../_static/js/workflow.js?v=1800024c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Contributor’s Guide" href="../../contributor/index.html" />
    <link rel="prev" title="Platform paper social experiment analysis: Part 1" href="social_analysis1_static.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">This website is currently under active development. Please report any issues on <a href='https://github.com/SainsburyWellcomeCentre/aeon_docs/issues'>GitHub</a>.</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Aeon v0.0.19</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../contributor/index.html">
    Contributor’s Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../reference/index.html">
    Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../about/index.html">
    About
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/SainsburyWellcomeCentre/aeon_docs" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../getting_started/index.html">
    Getting Started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../contributor/index.html">
    Contributor’s Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../reference/index.html">
    Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../about/index.html">
    About
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/SainsburyWellcomeCentre/aeon_docs" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../aeon_modules.html">Aeon Modules</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../aeon_modules/hardware.html">Hardware Assembly</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/hardware/commutation_translation.html">Commutation-Translation System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/hardware/foraging_patch.html">Foraging Patch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/hardware/habitat.html">Habitat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/hardware/nest.html">Nest</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/connections/camera.html">Camera Wiring Schematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/connections/camera_controller.html">Camera Controller Wiring Schematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/connections/commutation_translation_system.html">Commutation-Translation System Wiring Schematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/connections/foraging_patch.html">Foraging Patch Wiring Schematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/connections/foraging_patch_output_expander.html">Foraging Patch Output Expander Wiring Schematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/connections/microphone.html">Microphone Wiring Schematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/connections/rfid_reader.html">RFID Reader Wiring Schematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/connections/sound_card.html">Sound Card Wiring Schematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/connections/timestamp_generator.html">Timestamp Generator Wiring Schematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/connections/weighing_scale.html">Weighing Scale Wiring Schematic</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../aeon_modules/acquisition.html">Acquisition Modules</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/acquisition/activity_tracking.html">Activity Tracking</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/acquisition/alerts.html">Alerts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/acquisition/camera.html">Spinnaker Camera</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/acquisition/camera_controller.html">Multi-Camera Controller</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../aeon_modules/acquisition/control_panel.html">Control Panel</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../aeon_modules/acquisition/control_panel/annotation_source_GUI.html">AnnotationSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../aeon_modules/acquisition/control_panel/button_source_GUI.html">ButtonSource</a></li>
<li class="toctree-l4"><a class="reference internal" href="../aeon_modules/acquisition/control_panel/environment_state_GUI.html">EnvironmentState</a></li>
<li class="toctree-l4"><a class="reference internal" href="../aeon_modules/acquisition/control_panel/experiment_properties_GUI.html">ExperimentProperties</a></li>
<li class="toctree-l4"><a class="reference internal" href="../aeon_modules/acquisition/control_panel/label_control_GUI.html">LabelControl</a></li>
<li class="toctree-l4"><a class="reference internal" href="../aeon_modules/acquisition/control_panel/subject_database.html">SubjectDatabase <!--TODO: Placeholder content--></a></li>
</ul>
</details></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../aeon_modules/acquisition/foraging_patch.html">Foraging Patch</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../aeon_modules/acquisition/foraging_patch/patch_dispenser.html">PatchDispenser</a></li>
<li class="toctree-l4"><a class="reference internal" href="../aeon_modules/acquisition/foraging_patch/pellet_monitor.html">PelletMonitor</a></li>
<li class="toctree-l4"><a class="reference internal" href="../aeon_modules/acquisition/foraging_patch/time_since_last_event.html">TimeSinceLastEvent</a></li>
<li class="toctree-l4"><a class="reference internal" href="../aeon_modules/acquisition/foraging_patch/time_spent_on_wheel.html">TimeSpentOnWheel</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/acquisition/logging.html">Logging</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/acquisition/monitors.html">Device Synchronisation Monitors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/acquisition/nest.html">Nest</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/acquisition/rfid_reader.html">RFID Reader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../aeon_modules/acquisition/subject_tracking.html">Subject Tracking</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../sample_datasets.html">Sample Datasets</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorials.html">Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/aeon_dj_pipeline.html">DataJoint pipeline for Aeon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/general_experimental_workflow.html">General experimental workflow infrastructure</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../how_to.html">How-to Guides</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dj_compute_bouts_copy.html">DataJoint pipeline: Computing behavioural bouts</a></li>
<li class="toctree-l2"><a class="reference internal" href="dj_data_ingestion_and_processing.html">DataJoint pipeline: Data ingestion and processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dj_fetching_data_copy.html">DataJoint pipeline: Fetching data as DataFrames</a></li>
<li class="toctree-l2"><a class="reference internal" href="dj_pipeline_local_deployment.html">DataJoint pipeline: On-premises deployment</a></li>
<li class="toctree-l2"><a class="reference internal" href="dj_querying_data_copy.html">DataJoint pipeline: Querying data</a></li>
<li class="toctree-l2"><a class="reference internal" href="hmm_example.html">Hidden Markov Model analysis of mouse behavioural syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="io_api_example_copy.html">Data access using the low-level API</a></li>
<li class="toctree-l2"><a class="reference internal" href="social_analysis1_static.html">Platform paper social experiment analysis: Part 1</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Platform paper social experiment analysis: Part 2</a></li>
</ul>
</details></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">User Guide</a></li>
    
    
    <li class="breadcrumb-item"><a href="../how_to.html" class="nav-link">How-to Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Platform paper social experiment analysis: Part 2</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="platform-paper-social-experiment-analysis-part-2">
<h1>Platform paper social experiment analysis: Part 2<a class="headerlink" href="#platform-paper-social-experiment-analysis-part-2" title="Link to this heading">#</a></h1>
<p>In this example we will work with behavioural data collected from experiments <code class="docutils literal notranslate"><span class="pre">social0.2</span></code>, <code class="docutils literal notranslate"><span class="pre">social0.3</span></code>, and <code class="docutils literal notranslate"><span class="pre">social0.4</span></code>, in which two mice foraged for food in the <a class="reference internal" href="../aeon_modules/hardware/habitat.html#target-habitat"><span class="std std-ref">habitat</span></a> with three <a class="reference internal" href="../aeon_modules/hardware/foraging_patch.html#target-foraging-patch"><span class="std std-ref">foraging patches</span></a> whose reward rates changed dynamically over time.</p>
<p>The experiments each consist of three periods:</p>
<ol class="arabic simple">
<li><p>“presocial”, in which each mouse was in the habitat alone for 3-4 days.</p></li>
<li><p>“social”, in which both mice were in the habitat together for 2 weeks.</p></li>
<li><p>“postsocial”, in which each mouse was in the habitat alone again for 3-4 days.</p></li>
</ol>
<p>The goal of the experiments was to understand how the mice’s behaviour changes as they learn to forage for food in the habitat, and how their behaviour differs between social vs. solo settings.</p>
<p>The full datasets are available on the <a class="reference internal" href="../sample_datasets.html#target-full-datasets"><span class="std std-ref">Datasets</span></a> page but for the purpose of this example, we will be using the precomputed <a class="reference external" href="https://app.globus.org/file-manager?origin_id=48cc1398-b591-4f52-85d2-f68801306d4a&amp;amp;origin_path=%2F"><strong>Platform paper social analysis datasets</strong></a>.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>“Extended Data Fig. 7”, in “Extended Data” in the “Supplementary Material” of the <a class="reference external" href="https://www.biorxiv.org/content/10.1101/2025.07.31.664513">platform paper</a> for a detailed description of the experiments.</p>
</div>
<p>Below is a brief explanation of how the environment (i.e. patch properties) changed over <a class="reference internal" href="../../reference/glossary.html#term-Block"><span class="xref std std-term">blocks</span></a> (60–180 minute periods of time):</p>
<ol class="arabic">
<li><p>Every block begins at a random interval <span class="math notranslate nohighlight">\(t\)</span>:</p>
<div class="math notranslate nohighlight">
\[
    t \sim \mathrm{Uniform}(60,\,180) \quad \text{In minutes}
    \]</div>
</li>
<li><p>At the start of each block, sample a row from the predefined matrix <span class="math notranslate nohighlight">\(\lambda_{\mathrm{set}}\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \lambda_{\mathrm{set}} = 
    \begin{pmatrix}
    1 &amp; 1 &amp; 1 \\
    5 &amp; 5 &amp; 5 \\
    1 &amp; 3 &amp; 5 \\
    1 &amp; 5 &amp; 3 \\
    3 &amp; 1 &amp; 5 \\
    3 &amp; 5 &amp; 1 \\
    5 &amp; 1 &amp; 3 \\
    5 &amp; 3 &amp; 1 \\
    \end{pmatrix}
    \quad \text{In meters}
    \end{split}\]</div>
</li>
<li><p>Assign the sampled row to specific patch means <span class="math notranslate nohighlight">\(\lambda_{\mathrm{1}}, \lambda_{\mathrm{2}}, \lambda_{\mathrm{3}}\)</span> and apply a constant offset <span class="math notranslate nohighlight">\(c\)</span> to all thresholds:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{aligned}
    \lambda_{\mathrm{1}}, \lambda_{\mathrm{2}}, \lambda_{\mathrm{3}} &amp;\sim \mathrm{Uniform}(\lambda_{\mathrm{set}}) \\
    c &amp;= 0.75
    \end{aligned}
    \quad \text{Patch means and offset}
    \end{split}\]</div>
</li>
<li><p>Sample a value from each of <span class="math notranslate nohighlight">\(P_{\mathrm{1}}, P_{\mathrm{2}}, P_{\mathrm{3}}\)</span> as the initial threshold for the respective patch. Whenever a patch reaches its threshold, resample a new value from its corresponding distribution:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \begin{aligned}
    P_{\mathrm{1}} &amp;= c + \mathrm{Exp}(1/\lambda_{\mathrm{1}}) \\
    P_{\mathrm{2}} &amp;= c + \mathrm{Exp}(1/\lambda_{\mathrm{2}}) \\
    P_{\mathrm{3}} &amp;= c + \mathrm{Exp}(1/\lambda_{\mathrm{3}})
    \end{aligned}
    \quad \text{Patch distributions}
    \end{split}\]</div>
</li>
</ol>
<section id="set-up-environment">
<h2>Set up environment<a class="headerlink" href="#set-up-environment" title="Link to this heading">#</a></h2>
<p>Create and activate a virtual environment named <code class="docutils literal notranslate"><span class="pre">social-analysis</span></code> using <a class="reference external" href="https://docs.astral.sh/uv/getting-started/installation/">uv</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>venv<span class="w"> </span>aeon-social-analysis<span class="w"> </span>--python<span class="w"> </span><span class="s2">&quot;&gt;=3.11&quot;</span><span class="w"> </span>
<span class="nb">source</span><span class="w"> </span>aeon-social-analysis/bin/activate<span class="w">   </span><span class="c1"># Unix</span>
.<span class="se">\a</span>eon-social-analysis<span class="se">\S</span>cripts<span class="se">\a</span>ctivate<span class="w">   </span><span class="c1"># Windows</span>
</pre></div>
</div>
<p>Install the required <a class="reference external" href="https://github.com/lindermanlab/ssm"><code class="docutils literal notranslate"><span class="pre">ssm</span></code> package</a> and its dependencies.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>matplotlib<span class="w"> </span>numpy<span class="w"> </span>pandas<span class="w"> </span>plotly<span class="w"> </span>seaborn<span class="w"> </span>statsmodels<span class="w"> </span>pyyaml<span class="w"> </span>pyarrow<span class="w"> </span>tqdm<span class="w"> </span>scipy<span class="w"> </span>jupyter
</pre></div>
</div>
</section>
<section id="import-libraries-and-define-variables-and-helper-functions">
<h2>Import libraries and define variables and helper functions<a class="headerlink" href="#import-libraries-and-define-variables-and-helper-functions" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Notebook settings and imports&quot;&quot;&quot;</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">warnings</span><span class="w"> </span><span class="kn">import</span> <span class="n">warn</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">plotly</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.ndimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">uniform_filter1d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm.auto</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot settings</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.titlesize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.labelsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">18</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;xtick.labelsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;ytick.labelsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;legend.title_fontsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;legend.fontsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">14</span>

<span class="c1"># Constants</span>
<span class="n">cm2px</span> <span class="o">=</span> <span class="mf">5.2</span>  <span class="c1"># 1 cm = 5.2 px roughly in aeon arenas</span>
<span class="n">light_off</span><span class="p">,</span> <span class="n">light_on</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">20</span>  <span class="c1"># 7am to 8pm</span>

<span class="n">subject_colors</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">qualitative</span><span class="o">.</span><span class="n">Dark24</span>
<span class="n">patch_colors</span> <span class="o">=</span> <span class="n">plotly</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">qualitative</span><span class="o">.</span><span class="n">Light24</span>
<span class="n">patch_markers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;circle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bowtie&quot;</span><span class="p">,</span>
    <span class="s2">&quot;square&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hourglass&quot;</span><span class="p">,</span>
    <span class="s2">&quot;diamond&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cross&quot;</span><span class="p">,</span>
    <span class="s2">&quot;x&quot;</span><span class="p">,</span>
    <span class="s2">&quot;triangle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;star&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">patch_markers_symbols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;●&quot;</span><span class="p">,</span> <span class="s2">&quot;⧓&quot;</span><span class="p">,</span> <span class="s2">&quot;■&quot;</span><span class="p">,</span> <span class="s2">&quot;⧗&quot;</span><span class="p">,</span> <span class="s2">&quot;♦&quot;</span><span class="p">,</span> <span class="s2">&quot;✖&quot;</span><span class="p">,</span> <span class="s2">&quot;×&quot;</span><span class="p">,</span> <span class="s2">&quot;▲&quot;</span><span class="p">,</span> <span class="s2">&quot;★&quot;</span><span class="p">]</span>
<span class="n">patch_markers_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">patch_markers</span><span class="p">,</span> <span class="n">patch_markers_symbols</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
<span class="n">patch_markers_linestyles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span> <span class="s2">&quot;dash&quot;</span><span class="p">,</span> <span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="s2">&quot;dashdot&quot;</span><span class="p">,</span> <span class="s2">&quot;longdashdot&quot;</span><span class="p">]</span>
<span class="n">subject_markers_linestyles</span> <span class="o">=</span> <span class="n">patch_markers_linestyles</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">patch_type_mean_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">100</span><span class="p">:</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="mi">300</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="mi">200</span><span class="p">:</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="mi">600</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">}</span>
<span class="n">patch_type_rate_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mf">0.01</span><span class="p">:</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span>
    <span class="mf">0.0033</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
    <span class="mf">0.002</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span>
    <span class="mf">0.005</span><span class="p">:</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span>
    <span class="mf">0.00167</span><span class="p">:</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span>
    <span class="mf">0.001</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">experiments</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;social0.2-aeon3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;presocial_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-31 11:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;presocial_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-02-08 15:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-02-09 16:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-02-23 13:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postsocial_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-02-25 17:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postsocial_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-03-02 14:00:00&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;social0.2-aeon4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;presocial_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-01-31 11:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;presocial_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-02-08 15:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-02-09 17:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-02-23 12:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postsocial_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-02-25 18:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postsocial_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-03-02 13:00:00&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;social0.3-aeon3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;presocial_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-06-08 19:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;presocial_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-06-17 13:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-06-25 11:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-07-06 13:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postsocial_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-07-07 16:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postsocial_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-07-14 14:00:00&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;social0.3-aeon4&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;social0.4-aeon3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;presocial_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-08-16 17:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;presocial_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-08-24 10:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-08-28 11:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-09-09 13:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postsocial_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-09-09 18:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postsocial_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-09-22 16:00:00&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;social0.4-aeon4&quot;</span><span class="p">,</span>
        <span class="s2">&quot;presocial_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-08-16 15:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;presocial_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-08-24 10:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-08-28 10:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-09-09 01:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postsocial_start&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-09-09 15:00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;postsocial_end&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-09-22 16:00:00&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">periods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">]</span>

<span class="c1"># Define the possible combos of social and light</span>
<span class="n">combos</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1"># Social + Light</span>
    <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>  <span class="c1"># Social + Dark</span>
    <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1"># Solo + Light</span>
    <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>  <span class="c1"># Solo + Dark</span>
<span class="p">]</span>

<span class="c1"># Define colors based on light condition (light=blue, dark=orange)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;#1f77b4&quot;</span><span class="p">,</span>  <span class="c1"># Blue for light conditions</span>
    <span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;#ff7f0e&quot;</span><span class="p">,</span>  <span class="c1"># Orange for dark conditions</span>
<span class="p">}</span>

<span class="c1"># Define hatch patterns based on social condition</span>
<span class="n">hatches</span> <span class="o">=</span> <span class="p">{</span>
    <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;///&quot;</span><span class="p">,</span>  <span class="c1"># Hatched pattern for social</span>
    <span class="kc">False</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># No pattern (solid) for solo</span>
<span class="p">}</span>

<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Social-Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social-Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo-Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo-Dark&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">load_data_from_parquet</span><span class="p">(</span>
    <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">data_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">set_time_index</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads saved data from parquet files.</span>

<span class="sd">    Args:</span>
<span class="sd">        experiment_name (str, optional): Filter by experiment name. If None, load all experiments.</span>
<span class="sd">        period (str, optional): Filter by period (presocial, social, postsocial). If None, load all periods.</span>
<span class="sd">        data_type (str): Type of data to load (position, patch, foraging, rfid, sleep, explore)</span>
<span class="sd">        data_dir (Path): Directory containing parquet files.</span>
<span class="sd">        set_time_index (bool, optional): If True, set &#39;time&#39; column as DataFrame index.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Combined DataFrame of all matching parquet files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Directory </span><span class="si">{</span><span class="n">data_dir</span><span class="si">}</span><span class="s2"> does not exist. No data files found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Create pattern based on filters</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">experiment_name</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">_&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">+=</span> <span class="s2">&quot;*_&quot;</span>

    <span class="k">if</span> <span class="n">period</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pattern</span> <span class="o">+=</span> <span class="s2">&quot;*_&quot;</span>

    <span class="n">pattern</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.parquet&quot;</span>

    <span class="c1"># Find matching files</span>
    <span class="n">matching_files</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">matching_files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No matching data files found with pattern: </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">matching_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> matching files&quot;</span><span class="p">)</span>

    <span class="c1"># Load and concatenate matching files</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_rows</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">matching_files</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">total_rows</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>

    <span class="c1"># Combine data</span>
    <span class="k">if</span> <span class="n">dfs</span><span class="p">:</span>
        <span class="n">combined_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">set_time_index</span> <span class="ow">and</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">combined_df</span> <span class="o">=</span> <span class="n">combined_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Combined data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">combined_df</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">combined_df</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">load_experiment_data</span><span class="p">(</span>
    <span class="n">data_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">experiment</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">periods</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">data_types</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;rfid&quot;</span><span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">],</span>
    <span class="n">trim_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load all data types for specified periods of an experiment.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - experiment: experiment dict with period start/end times</span>
<span class="sd">    - periods: list of periods to load</span>
<span class="sd">    - data_types: list of data types to load</span>
<span class="sd">    - data_dir: directory containing data files</span>
<span class="sd">    - trim_days: Optional number of days to trim from start (None = no trim)</span>

<span class="sd">    Returns:</span>
<span class="sd">    - Dictionary containing dataframes for each period/data type combination</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">periods</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">periods</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">data_type</span> <span class="ow">in</span> <span class="n">data_types</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading </span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2"> data...&quot;</span><span class="p">)</span>

            <span class="c1"># Load data</span>
            <span class="n">experiment_name</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">experiment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">load_data_from_parquet</span><span class="p">(</span>
                <span class="n">experiment_name</span><span class="o">=</span><span class="n">experiment_name</span><span class="p">,</span>
                <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
                <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
                <span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
                <span class="n">set_time_index</span><span class="o">=</span><span class="p">(</span><span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;position&quot;</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="c1"># Trim if requested</span>
            <span class="k">if</span> <span class="n">trim_days</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;rfid&quot;</span><span class="p">:</span>
                    <span class="n">start_time</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;chunk_start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">trim_days</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;chunk_start&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;foraging&quot;</span><span class="p">:</span>
                    <span class="n">start_time</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">trim_days</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;position&quot;</span><span class="p">:</span>
                    <span class="n">start_time</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                    <span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">trim_days</span><span class="p">)</span>
                    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">]</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Trimmed to </span><span class="si">{</span><span class="n">trim_days</span><span class="si">}</span><span class="s2"> days: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2"> records&quot;</span><span class="p">)</span>

            <span class="c1"># Store in result</span>
            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>

            <span class="c1"># For position data, handle duplicates</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;position&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">original_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;identity_name&quot;</span><span class="p">])</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
                <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">original_len</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Removed duplicates: </span><span class="si">{</span><span class="n">original_len</span><span class="si">}</span><span class="s2"> -&gt; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Change <code class="docutils literal notranslate"><span class="pre">data_dir</span></code> and <code class="docutils literal notranslate"><span class="pre">save_dir</span></code> to the paths where your local dataset (the parquet files) is stored and where you want to save the results.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SET THESE VARIABLES ACCORDINGLY</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">save_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="solo-vs-social-behaviours">
<h2>Solo vs. Social Behaviours<a class="headerlink" href="#solo-vs-social-behaviours" title="Link to this heading">#</a></h2>
<section id="exploring">
<h3>Exploring<a class="headerlink" href="#exploring" title="Link to this heading">#</a></h3>
<section id="distance-travelled">
<h4>Distance travelled<a class="headerlink" href="#distance-travelled" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Final df:</span>
<span class="c1"># rows = hour-datetime,</span>
<span class="c1"># columns = distance, exp, social-bool, subject, light-bool</span>

<span class="n">dist_trav_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">,</span> <span class="s2">&quot;exp&quot;</span><span class="p">,</span> <span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each period</span>
<span class="c1"># Load pos data</span>
<span class="c1"># Split into individual dfs</span>
<span class="c1"># If social, excise swaps</span>
<span class="c1"># Smooth down to 1s</span>
<span class="c1"># Calculate hour-by-hour distance traveled, and put into final df</span>

<span class="n">exp_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">experiments</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Experiments&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">exp_pbar</span><span class="p">:</span>
    <span class="n">period_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Periods&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">period_pbar</span><span class="p">:</span>
        <span class="n">pos_df</span> <span class="o">=</span> <span class="n">load_data_from_parquet</span><span class="p">(</span>
            <span class="n">experiment_name</span><span class="o">=</span><span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
            <span class="n">set_time_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">pos_df</span><span class="p">[</span><span class="s2">&quot;identity_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">pos_df_subj</span> <span class="o">=</span> <span class="n">pos_df</span><span class="p">[</span><span class="n">pos_df</span><span class="p">[</span><span class="s2">&quot;identity_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subject</span><span class="p">]</span>
            <span class="n">pos_df_subj</span> <span class="o">=</span> <span class="n">pos_df_subj</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;200ms&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
            <span class="n">pos_df_subj</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">pos_df_subj</span><span class="p">[[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="s2">&quot;1s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">pos_df_subj</span> <span class="o">=</span> <span class="n">pos_df_subj</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;1s&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
            <span class="n">pos_df_subj</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="p">(</span><span class="n">pos_df_subj</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">pos_df_subj</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">pos_df_subj</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">pos_df_subj</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pos_df_subj</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">cm2px</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># convert to m</span>
            <span class="n">pos_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_df_subj</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
            <span class="n">pos_df_subj_hour</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">pos_df_subj</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">)[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">pos_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">pos_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span>
            <span class="n">pos_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">pos_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
            <span class="n">pos_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="n">light_off</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="n">light_on</span><span class="p">))</span>
            <span class="n">dist_trav_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">dist_trav_hour_df</span><span class="p">,</span> <span class="n">pos_df_subj_hour</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Save as parquet</span>
<span class="c1"># dist_trav_hour_df.to_parquet(</span>
<span class="c1">#     data_dir / &quot;for_plots&quot; / &quot;dist_trav_hour_df.parquet&quot;,</span>
<span class="c1">#     engine=&quot;pyarrow&quot;,</span>
<span class="c1">#     compression=&quot;snappy&quot;,</span>
<span class="c1">#     index=False,</span>
<span class="c1"># )</span>

<span class="c1"># Load the parquet file</span>
<span class="n">dist_trav_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span>
    <span class="n">data_dir</span> <span class="o">/</span> <span class="s2">&quot;for_plots&quot;</span> <span class="o">/</span> <span class="s2">&quot;dist_trav_hour_df.parquet&quot;</span><span class="p">,</span>
    <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;pyarrow&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hour</th>
      <th>distance</th>
      <th>exp</th>
      <th>social</th>
      <th>subject</th>
      <th>light</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2024-01-31 11:00:00</td>
      <td>214.375787</td>
      <td>social0.2-aeon3</td>
      <td>False</td>
      <td>BAA-1104045</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2024-01-31 12:00:00</td>
      <td>358.672416</td>
      <td>social0.2-aeon3</td>
      <td>False</td>
      <td>BAA-1104045</td>
      <td>False</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2024-01-31 13:00:00</td>
      <td>301.952548</td>
      <td>social0.2-aeon3</td>
      <td>False</td>
      <td>BAA-1104045</td>
      <td>False</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2024-01-31 14:00:00</td>
      <td>284.154738</td>
      <td>social0.2-aeon3</td>
      <td>False</td>
      <td>BAA-1104045</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2024-01-31 15:00:00</td>
      <td>420.268372</td>
      <td>social0.2-aeon3</td>
      <td>False</td>
      <td>BAA-1104045</td>
      <td>False</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4840</th>
      <td>2024-09-22 13:00:00</td>
      <td>263.921865</td>
      <td>social0.4-aeon4</td>
      <td>False</td>
      <td>BAA-1104797</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4841</th>
      <td>2024-09-22 14:00:00</td>
      <td>316.511526</td>
      <td>social0.4-aeon4</td>
      <td>False</td>
      <td>BAA-1104797</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4842</th>
      <td>2024-09-22 15:00:00</td>
      <td>281.001766</td>
      <td>social0.4-aeon4</td>
      <td>False</td>
      <td>BAA-1104797</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4843</th>
      <td>2024-09-22 16:00:00</td>
      <td>171.733688</td>
      <td>social0.4-aeon4</td>
      <td>False</td>
      <td>BAA-1104797</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4844</th>
      <td>2024-09-22 17:00:00</td>
      <td>0.000905</td>
      <td>social0.4-aeon4</td>
      <td>False</td>
      <td>BAA-1104797</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
<p>4845 rows × 6 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Hists.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot histograms for each combination</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">social_val</span><span class="p">,</span> <span class="n">light_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combos</span><span class="p">):</span>
    <span class="c1"># Filter data for this combination</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">dist_trav_hour_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># Plot normalized histogram</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;distance&quot;</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;probability&quot;</span><span class="p">,</span>  <span class="c1"># This normalizes the histogram</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="c1"># kde=True,  # Add kernel density estimate</span>
        <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Ensure each histogram is normalized separately</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">binwidth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Set hatch pattern for bars</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">hist</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Normalized Distance Traveled Distributions by Social and Light Conditions&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Distance Traveled (m / h)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.0, 0.2)
</pre></div>
</div>
<img alt="../../_images/9cdba9fd9fb2b1d02544e77933dd189d4204130bc0188a65841bf058e3c064e5.png" src="../../_images/9cdba9fd9fb2b1d02544e77933dd189d4204130bc0188a65841bf058e3c064e5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Bars.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">dist_trav_hour_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_dist</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_dist</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_distance&quot;</span><span class="p">:</span> <span class="n">mean_dist</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_dist</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_distance&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Plotting </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: mean=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mean_distance&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sem=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;sem&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_distance&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean Distance Traveled (m / h)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Distance Traveled by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Add stats tests</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">dist_trav_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">dist_trav_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">dist_trav_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">dist_trav_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dist_trav_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.02</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting (&#39;Social-Light&#39;,): mean=65.89, sem=2.22, n=1666
Plotting (&#39;Social-Dark&#39;,): mean=283.67, sem=3.74, n=1406
Plotting (&#39;Solo-Light&#39;,): mean=22.04, sem=1.20, n=949
Plotting (&#39;Solo-Dark&#39;,): mean=135.10, sem=3.63, n=824
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.02, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 9.89e-64\nDark conditions: p = 2.04e-151&#39;)
</pre></div>
</div>
<img alt="../../_images/5f31daea637562e18006f2f45bb8dfea3f8b011f8dcbf0e0bd0629bb2d528bb0.png" src="../../_images/5f31daea637562e18006f2f45bb8dfea3f8b011f8dcbf0e0bd0629bb2d528bb0.png" />
</div>
</div>
</section>
<section id="bouts">
<h4>Bouts<a class="headerlink" href="#bouts" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Final df:</span>
<span class="c1"># rows = hour-datetime,</span>
<span class="c1"># columns = n_bouts, exp, social-bool, subject, light-bool</span>

<span class="n">explore_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;n_bouts&quot;</span><span class="p">,</span> <span class="s2">&quot;exp&quot;</span><span class="p">,</span> <span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">explore_dur_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="s2">&quot;exp&quot;</span><span class="p">,</span> <span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">exp_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">experiments</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Experiments&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">exp_pbar</span><span class="p">:</span>
    <span class="n">period_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Periods&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">period_pbar</span><span class="p">:</span>
        <span class="n">explore_bouts_df</span> <span class="o">=</span> <span class="n">load_data_from_parquet</span><span class="p">(</span>
            <span class="n">experiment_name</span><span class="o">=</span><span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;explore&quot;</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
            <span class="n">set_time_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">explore_bouts_df</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">explore_df_subj</span> <span class="o">=</span> <span class="n">explore_bouts_df</span><span class="p">[</span><span class="n">explore_bouts_df</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subject</span><span class="p">]</span>
            <span class="n">explore_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">explore_df_subj</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
            <span class="n">min_hour</span><span class="p">,</span> <span class="n">max_hour</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">explore_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="n">explore_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">complete_hours</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;hour&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">min_hour</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">max_hour</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">)}</span>
            <span class="p">)</span>
            <span class="n">hour_counts</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">explore_df_subj</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">explore_df_subj_hour</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">complete_hours</span><span class="p">,</span> <span class="n">hour_counts</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">explore_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">explore_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="nb">int</span>
            <span class="p">)</span>
            <span class="n">explore_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">explore_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span>
            <span class="n">explore_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">explore_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
            <span class="n">explore_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="n">light_off</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="n">light_on</span><span class="p">))</span>
            <span class="n">explore_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">explore_hour_df</span><span class="p">,</span> <span class="n">explore_df_subj_hour</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="n">explore_dur_subj</span> <span class="o">=</span> <span class="n">explore_df_subj</span><span class="p">[[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">explore_dur_subj</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">explore_dur_subj</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span>
            <span class="n">explore_dur_subj</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">explore_dur_subj</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
            <span class="n">explore_dur_subj</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="n">light_off</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="n">light_on</span><span class="p">))</span>
            <span class="n">explore_dur_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">explore_dur_df</span><span class="p">,</span> <span class="n">explore_dur_subj</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

<span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
<span class="n">explore_dur_df</span> <span class="o">=</span> <span class="n">explore_dur_df</span><span class="p">[</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">120</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Plot hist of bouts per hour&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot histograms for each combination</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">social_val</span><span class="p">,</span> <span class="n">light_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combos</span><span class="p">):</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">explore_hour_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># Plot normalized histogram</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;probability&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Ensure each histogram is normalized separately</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">binwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Set hatch pattern for bars</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">hist</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Normalized Exploration Bout Distributions by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of bouts / hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.0, 15.0)
</pre></div>
</div>
<img alt="../../_images/1cc02d89525d2a1000b7946ef60defbdf7561de7474f3bdb026457bb20b1b431.png" src="../../_images/1cc02d89525d2a1000b7946ef60defbdf7561de7474f3bdb026457bb20b1b431.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Plot bars of bouts per hour&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">explore_hour_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_n_bouts</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_n_bouts</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">:</span> <span class="n">mean_n_bouts</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_n_bouts</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Number of Exploration Bouts by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of bouts / hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Perform Wilcoxon rank sum tests (Mann-Whitney U)</span>
<span class="n">light_social</span> <span class="o">=</span> <span class="n">explore_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">explore_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">explore_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">explore_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.02</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.02, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 1.31e-15\nDark conditions: p = 3.01e-10&#39;)
</pre></div>
</div>
<img alt="../../_images/9cb72837d9fd9cf0b733b4807ee808eda37561a54271d0de44f7eb82685020c3.png" src="../../_images/9cb72837d9fd9cf0b733b4807ee808eda37561a54271d0de44f7eb82685020c3.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Plot hist of durations of bouts.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot histograms for each combination</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">social_val</span><span class="p">,</span> <span class="n">light_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combos</span><span class="p">):</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">explore_dur_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># Plot normalized histogram</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;duration&quot;</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;probability&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="c1"># kde=True,  # Add kernel density estimate</span>
        <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Ensure each histogram is normalized separately</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">binwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Set hatch pattern for bars</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">hist</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Normalized Exploration Bout Duration Distributions by Social and Light Conditions&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Duration (mins)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.0, 0.3)
</pre></div>
</div>
<img alt="../../_images/e5f97261c2d651abc9633c56f90c5ca12adbb535acebf4dae3dceda42cfdf71f.png" src="../../_images/e5f97261c2d651abc9633c56f90c5ca12adbb535acebf4dae3dceda42cfdf71f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Plot bars of durations of bouts.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">explore_dur_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_duration&quot;</span><span class="p">:</span> <span class="n">mean_duration</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_duration</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Exploration Bout Duration by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Duration (minutes)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Perform Wilcoxon rank sum tests (Mann-Whitney U)</span>
<span class="n">light_social</span> <span class="o">=</span> <span class="n">explore_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">explore_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">explore_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">explore_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.02</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.02, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 1.79e-03\nDark conditions: p = 3.03e-08&#39;)
</pre></div>
</div>
<img alt="../../_images/6452e233965aada91ee83dda3568b424400f038549b74e06489fef1a1e5e2468.png" src="../../_images/6452e233965aada91ee83dda3568b424400f038549b74e06489fef1a1e5e2468.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Plot hist of times of bouts over all hours.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]):</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">explore_dur_df</span><span class="p">[(</span><span class="n">explore_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)]</span>

    <span class="c1"># Create the histogram</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="n">subset</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;probability&quot;</span><span class="p">,</span>  <span class="c1"># Normalize to show probability</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Social&quot;</span> <span class="k">if</span> <span class="n">social_val</span> <span class="k">else</span> <span class="s2">&quot;Solo&quot;</span><span class="p">,</span>
        <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Each condition normalized separately</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>  <span class="c1"># 24 hours</span>
        <span class="n">discrete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Since hours are discrete values</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching pattern for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="c1"># Apply the hatch pattern to each bar</span>
        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">hist</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

<span class="c1"># Set x-tick labels for every hour</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:00&quot;</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">)],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Customize axis labels and title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Distribution of Exploration Bouts Throughout the Day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hour of Day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x755ef01cce90&gt;
</pre></div>
</div>
<img alt="../../_images/6f1b1e1fad4633fbee81fef66cd2af08bf6116b3b484936e42dc9afe3a3f48b8.png" src="../../_images/6f1b1e1fad4633fbee81fef66cd2af08bf6116b3b484936e42dc9afe3a3f48b8.png" />
</div>
</div>
</section>
</section>
<section id="foraging">
<h3>Foraging<a class="headerlink" href="#foraging" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Final dfs:</span>
<span class="c1"># 1. forage_hour_df: hour, n_pellets, dist_forage, n_bouts, exp, social-bool, subject, light-bool</span>
<span class="c1"># 2. forage_dur_df: start, duration(mins), exp, social-bool, subject, light-bool</span>

<span class="n">forage_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;hour&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_bouts&quot;</span><span class="p">,</span>
        <span class="s2">&quot;n_pellets&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dist_forage&quot;</span><span class="p">,</span>
        <span class="s2">&quot;exp&quot;</span><span class="p">,</span>
        <span class="s2">&quot;social&quot;</span><span class="p">,</span>
        <span class="s2">&quot;subject&quot;</span><span class="p">,</span>
        <span class="s2">&quot;light&quot;</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>
<span class="n">forage_dur_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="s2">&quot;exp&quot;</span><span class="p">,</span> <span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each period</span>
<span class="c1"># Load foraging data</span>
<span class="c1"># Split into individual dfs</span>
<span class="c1"># Calculate hour-by-hour metrics and put into final df</span>

<span class="n">exp_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">experiments</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Experiments&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">exp_pbar</span><span class="p">:</span>
    <span class="n">period_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Periods&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">period_pbar</span><span class="p">:</span>
        <span class="n">forage_df</span> <span class="o">=</span> <span class="n">load_data_from_parquet</span><span class="p">(</span>
            <span class="n">experiment_name</span><span class="o">=</span><span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;foraging&quot;</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
            <span class="n">set_time_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">forage_df</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">forage_df_subj</span> <span class="o">=</span> <span class="n">forage_df</span><span class="p">[</span><span class="n">forage_df</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subject</span><span class="p">]</span>
            <span class="n">forage_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forage_df_subj</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
            <span class="n">hour_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">forage_df_subj</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">),</span>
                <span class="n">forage_df_subj</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
                    <span class="n">n_pellets</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">),</span>
                    <span class="n">cum_wheel_dist</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;cum_wheel_dist&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">on</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span>
                <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">min_hour</span><span class="p">,</span> <span class="n">max_hour</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">forage_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="n">forage_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">complete_hours</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;hour&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">min_hour</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">max_hour</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">)}</span>
            <span class="p">)</span>
            <span class="n">forage_df_subj_hour</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">complete_hours</span><span class="p">,</span> <span class="n">hour_counts</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">forage_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">forage_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="c1"># Rename &#39;cum_wheel_dist&#39; col</span>
            <span class="n">forage_df_subj_hour</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
                <span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;cum_wheel_dist&quot;</span><span class="p">:</span> <span class="s2">&quot;dist_forage&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">forage_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">forage_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span>
            <span class="n">forage_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">forage_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
            <span class="n">forage_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="n">light_off</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="n">light_on</span><span class="p">))</span>
            <span class="n">forage_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">forage_hour_df</span><span class="p">,</span> <span class="n">forage_df_subj_hour</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="n">forage_dur_subj</span> <span class="o">=</span> <span class="n">forage_df_subj</span><span class="p">[[</span><span class="s2">&quot;start&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">forage_dur_subj</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">forage_df_subj</span><span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">forage_df_subj</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
            <span class="n">forage_dur_subj</span><span class="p">[</span><span class="s2">&quot;exp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">forage_dur_subj</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span>
            <span class="n">forage_dur_subj</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">forage_df_subj</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
            <span class="n">forage_dur_subj</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="n">light_off</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="n">light_on</span><span class="p">))</span>
            <span class="n">forage_dur_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">forage_dur_df</span><span class="p">,</span> <span class="n">forage_dur_subj</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Foraging bouts per hour histogram.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot histograms for each combination</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">social_val</span><span class="p">,</span> <span class="n">light_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combos</span><span class="p">):</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># Plot normalized histogram</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;probability&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="c1"># kde=True,  # Add kernel density estimate</span>
        <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Ensure each histogram is normalized separately</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">binwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Set hatch pattern for bars</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">hist</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Normalized Foraging Bout Distributions by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Foraging bouts / hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.0, 15.0)
</pre></div>
</div>
<img alt="../../_images/718b7e52c891217d25dae8bc50c54c6ca6c7c22f2e2d6d1ad9e4213216fc04cc.png" src="../../_images/718b7e52c891217d25dae8bc50c54c6ca6c7c22f2e2d6d1ad9e4213216fc04cc.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Foraging bouts per hour bars.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_n_bouts</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_n_bouts</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">:</span> <span class="n">mean_n_bouts</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_n_bouts</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Plotting </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: mean=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mean_n_bouts&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sem=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;sem&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Number of Foraging Bouts per Hour by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of bouts / hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Wilcoxon rank sum tests</span>
<span class="n">light_social</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.02</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting Social-Light: mean=0.29, sem=0.02, n=1801
Plotting Social-Dark: mean=4.07, sem=0.08, n=1804
Plotting Solo-Light: mean=0.10, sem=0.02, n=491
Plotting Solo-Dark: mean=3.22, sem=0.17, n=467
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.02, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 1.10e-12\nDark conditions: p = 4.51e-06&#39;)
</pre></div>
</div>
<img alt="../../_images/ce0e11c0a733ffc118d438c8d65b4bc7f2ce5080910eb43c7d20f388c2cb9590.png" src="../../_images/ce0e11c0a733ffc118d438c8d65b4bc7f2ce5080910eb43c7d20f388c2cb9590.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Foraging bouts duration histogram.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot histograms for each combination</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">social_val</span><span class="p">,</span> <span class="n">light_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combos</span><span class="p">):</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">forage_dur_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># Plot normalized histogram</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;duration&quot;</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;probability&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="c1"># kde=True,  # Add kernel density estimate</span>
        <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Ensure each histogram is normalized separately</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">binwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Set hatch pattern for bars</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">hist</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Normalized Foraging Bout Duration Distributions by Social and Light Conditions&quot;</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Duration (mins)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="c1"># ax.set_ylim(0, 0.3)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.0, 20.0)
</pre></div>
</div>
<img alt="../../_images/1c0af6bfe2c8ebe0c779dca82781387dd68982a135e1ba83a83971fa8198d7a6.png" src="../../_images/1c0af6bfe2c8ebe0c779dca82781387dd68982a135e1ba83a83971fa8198d7a6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Foraging bouts duration bars.&quot;&quot;&quot;</span>

<span class="n">max_forage_thresh</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># in minutes</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">forage_dur_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_forage_thresh</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_duration&quot;</span><span class="p">:</span> <span class="n">mean_duration</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_duration</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Plotting </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: mean=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mean_duration&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sem=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;sem&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Duration of Foraging Bouts by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean Duration (minutes)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Wilcoxon rank sum tests</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">forage_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_forage_thresh</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">forage_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_forage_thresh</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">forage_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_forage_thresh</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">forage_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
    <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_forage_thresh</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.80</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting Social-Light: mean=3.94, sem=0.12, n=518
Plotting Social-Dark: mean=3.01, sem=0.02, n=7350
Plotting Solo-Light: mean=7.40, sem=0.60, n=48
Plotting Solo-Dark: mean=3.31, sem=0.06, n=1504
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.8, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 7.01e-07\nDark conditions: p = 1.70e-06&#39;)
</pre></div>
</div>
<img alt="../../_images/4bfdc2390468edcbf938d6d424cc8a720de6b1d09d6c47a1f8ec24f5ab0a744c.png" src="../../_images/4bfdc2390468edcbf938d6d424cc8a720de6b1d09d6c47a1f8ec24f5ab0a744c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Foraging bouts over all hours histogram.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]):</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">forage_dur_df</span><span class="p">[(</span><span class="n">forage_dur_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)]</span>

    <span class="c1"># Create the histogram</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="n">subset</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;probability&quot;</span><span class="p">,</span>  <span class="c1"># Normalize to show probability</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;teal&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Social&quot;</span> <span class="k">if</span> <span class="n">social_val</span> <span class="k">else</span> <span class="s2">&quot;Solo&quot;</span><span class="p">,</span>
        <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Each condition normalized separately</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>  <span class="c1"># 24 hours</span>
        <span class="n">discrete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Since hours are discrete values</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching pattern for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="c1"># Apply the hatch pattern to each bar</span>
        <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="n">hist</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">patch</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

<span class="c1"># Set x-tick labels for every hour</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:00&quot;</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">)],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Customize axis labels and title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Distribution of Foraging Bouts Throughout the Day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Hour of Day&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x755ee7c90d50&gt;
</pre></div>
</div>
<img alt="../../_images/826df014abfd34801b7b68172360e4f1acbaea4d61b40edfebfe99a00d3e772d.png" src="../../_images/826df014abfd34801b7b68172360e4f1acbaea4d61b40edfebfe99a00d3e772d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Pellet rate per hour histogram.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot histograms for each combination</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">social_val</span><span class="p">,</span> <span class="n">light_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combos</span><span class="p">):</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># Plot normalized histogram</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;probability&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="c1"># kde=True,  # Add kernel density estimate</span>
        <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Ensure each histogram is normalized separately</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">binwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Set hatch pattern for bars</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">hist</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Normalized Pellet Rate Distributions by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of pellets / hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3.0, 35.0)
</pre></div>
</div>
<img alt="../../_images/7d1d6617729e7c817e6845f2c9d5bc4252a1699d415e748854c14bce4ef6102c.png" src="../../_images/7d1d6617729e7c817e6845f2c9d5bc4252a1699d415e748854c14bce4ef6102c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Pellet rate per hour bars.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_n_pellets</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_n_pellets</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_n_pellets&quot;</span><span class="p">:</span> <span class="n">mean_n_pellets</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_n_pellets</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_n_pellets&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Plotting </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: mean=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mean_n_pellets&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sem=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;sem&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_n_pellets&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Number of Pellets per hour by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of pellets / hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.02</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend (since legend is upper left)</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting Social-Light: mean=1.13, sem=0.08, n=1801
Plotting Social-Dark: mean=11.53, sem=0.22, n=1804
Plotting Solo-Light: mean=0.83, sem=0.15, n=491
Plotting Solo-Dark: mean=12.33, sem=0.54, n=467
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.02, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 8.50e-02\nDark conditions: p = 1.70e-01&#39;)
</pre></div>
</div>
<img alt="../../_images/c584a303b2be30948c05e5e07b60b6b8208a82c990e5360198544faaf1680c81.png" src="../../_images/c584a303b2be30948c05e5e07b60b6b8208a82c990e5360198544faaf1680c81.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Distance foraged rate per hour histogram.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot histograms for each combination</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">social_val</span><span class="p">,</span> <span class="n">light_val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">combos</span><span class="p">):</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;n_pellets&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="c1"># Plot normalized histogram</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;dist_forage&quot;</span><span class="p">,</span>
        <span class="n">stat</span><span class="o">=</span><span class="s2">&quot;probability&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="c1"># kde=True,  # Add kernel density estimate</span>
        <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Ensure each histogram is normalized separately</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">binwidth</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Set hatch pattern for bars</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="n">hist</span><span class="o">.</span><span class="n">patches</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Normalized Distance Foraged Distributions by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Distance foraged / hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.0, 15000.0)
</pre></div>
</div>
<img alt="../../_images/6aa32b8988c30eeb363111cb9e04553ad2ec3e647622681aa1dacfcf1f72495b.png" src="../../_images/6aa32b8988c30eeb363111cb9e04553ad2ec3e647622681aa1dacfcf1f72495b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Distance foraged rate per hour bars.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_dist_forage</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;dist_forage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_dist_forage</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;dist_forage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_dist_forage&quot;</span><span class="p">:</span> <span class="n">mean_dist_forage</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_dist_forage</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_dist_forage&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Plotting </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: mean=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mean_dist_forage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sem=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;sem&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_dist_forage&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Distance Foraged per hour by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Distance foraged / hour (cm)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;dist_forage&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;dist_forage&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;dist_forage&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">forage_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">forage_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;dist_forage&quot;</span><span class="p">]</span>

<span class="c1"># Wilcoxon rank sum tests</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.02</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend (since legend is upper left)</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting Social-Light: mean=371.06, sem=25.59, n=1801
Plotting Social-Dark: mean=3642.21, sem=78.83, n=1804
Plotting Solo-Light: mean=369.63, sem=66.23, n=491
Plotting Solo-Dark: mean=4552.04, sem=229.82, n=467
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.02, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 9.84e-01\nDark conditions: p = 1.99e-04&#39;)
</pre></div>
</div>
<img alt="../../_images/9da20799bc96475fdd2fefbddeba4c75fb4f44472628f8343d11277ae9ec54b9.png" src="../../_images/9da20799bc96475fdd2fefbddeba4c75fb4f44472628f8343d11277ae9ec54b9.png" />
</div>
</div>
</section>
<section id="sleeping">
<h3>Sleeping<a class="headerlink" href="#sleeping" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>n_bouts / hour</p></li>
<li><p>duration of bouts</p></li>
<li><p>total time spent sleeping / hour</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sleep_dur_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">sleep_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;n_bouts&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">exp_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">experiments</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Experiments&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">exp_pbar</span><span class="p">:</span>
    <span class="n">period_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Periods&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">period_pbar</span><span class="p">:</span>
        <span class="n">sleep_bouts_df</span> <span class="o">=</span> <span class="n">load_data_from_parquet</span><span class="p">(</span>
            <span class="n">experiment_name</span><span class="o">=</span><span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;sleep&quot;</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
            <span class="n">set_time_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Get sleep bout durations</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="n">sleep_bouts_df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
        <span class="n">sleep_bouts_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="n">light_off</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="n">light_on</span><span class="p">))</span>
        <span class="n">sleep_dur_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sleep_dur_df</span><span class="p">,</span> <span class="n">sleep_bouts_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Get n sleep bouts and total duration per hour</span>
        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">sleep_bouts_df</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">sleep_df_subj</span> <span class="o">=</span> <span class="n">sleep_bouts_df</span><span class="p">[</span><span class="n">sleep_bouts_df</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subject</span><span class="p">]</span>
            <span class="n">sleep_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sleep_df_subj</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
            <span class="n">hour_stats</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">sleep_df_subj</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">]})</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">hour_stats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;n_bouts&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">]</span>

            <span class="n">min_hour</span><span class="p">,</span> <span class="n">max_hour</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">sleep_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="n">sleep_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">complete_hours</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;hour&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">min_hour</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">max_hour</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">)}</span>
            <span class="p">)</span>
            <span class="n">sleep_df_subj_hour</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">complete_hours</span><span class="p">,</span> <span class="n">hour_stats</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span>
            <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
            <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="n">light_off</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="n">light_on</span><span class="p">))</span>
            <span class="n">sleep_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">sleep_hour_df</span><span class="p">,</span> <span class="n">sleep_df_subj_hour</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

<span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
<span class="p">)</span>
<span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Plot bars of bouts per hour&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">sleep_hour_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_n_bouts</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_n_bouts</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">:</span> <span class="n">mean_n_bouts</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_n_bouts</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;social&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Plotting </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: mean=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mean_n_bouts&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sem=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;sem&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Number of Sleeping Bouts per hour by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of bouts / hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Perform stats tests</span>
<span class="n">light_social</span> <span class="o">=</span> <span class="n">sleep_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">sleep_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">sleep_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">sleep_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.40</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting Social-Light: mean=3.44, sem=0.05, n=1834
Plotting Social-Dark: mean=2.06, sem=0.05, n=1815
Plotting Solo-Light: mean=1.04, sem=0.05, n=528
Plotting Solo-Dark: mean=2.26, sem=0.07, n=515
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.4, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 7.02e-86\nDark conditions: p = 1.53e-02&#39;)
</pre></div>
</div>
<img alt="../../_images/c1975260f922829c7dcf723d43160d429a3ec3d71e5a1b3a458598014a2f7611.png" src="../../_images/c1975260f922829c7dcf723d43160d429a3ec3d71e5a1b3a458598014a2f7611.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Plot bars of durations of bouts.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">sleep_dur_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_duration&quot;</span><span class="p">:</span> <span class="n">mean_duration</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_duration</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;social&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Plotting </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: mean=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mean_duration&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sem=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;sem&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Sleeping Bout Duration by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Duration (minutes)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Perform stats tests</span>
<span class="n">light_social</span> <span class="o">=</span> <span class="n">sleep_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">sleep_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">sleep_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">sleep_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.40</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting Social-Light: mean=6.33, sem=0.09, n=6308
Plotting Social-Dark: mean=4.20, sem=0.09, n=3743
Plotting Solo-Light: mean=48.14, sem=2.33, n=547
Plotting Solo-Dark: mean=11.79, sem=0.73, n=1164
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.4, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 2.65e-65\nDark conditions: p = 5.44e-24&#39;)
</pre></div>
</div>
<img alt="../../_images/21db911eee3392475d603e0217d367800aaa8f236f2f12e942961964fe022155.png" src="../../_images/21db911eee3392475d603e0217d367800aaa8f236f2f12e942961964fe022155.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Total time spent sleeping per hour.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">sleep_hour_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_duration&quot;</span><span class="p">:</span> <span class="n">mean_duration</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_duration</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;social&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Plotting </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: mean=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mean_duration&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sem=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;sem&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Sleeping Time per hour by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Duration (minutes)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Perform stats tests</span>
<span class="n">light_social</span> <span class="o">=</span> <span class="n">sleep_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">sleep_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">sleep_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">sleep_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sleep_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.40</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting Social-Light: mean=21.78, sem=0.38, n=1834
Plotting Social-Dark: mean=8.66, sem=0.28, n=1815
Plotting Solo-Light: mean=49.87, sem=2.53, n=528
Plotting Solo-Dark: mean=26.64, sem=1.59, n=515
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.4, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 7.87e-151\nDark conditions: p = 3.93e-26&#39;)
</pre></div>
</div>
<img alt="../../_images/6e91a4a39b43002238651453833399819db482ad916d00fa7baa39f61a5edcf9.png" src="../../_images/6e91a4a39b43002238651453833399819db482ad916d00fa7baa39f61a5edcf9.png" />
</div>
</div>
</section>
<section id="drinking">
<h3>Drinking<a class="headerlink" href="#drinking" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>n_bouts / hour</p></li>
<li><p>duration of bouts</p></li>
<li><p>total time spent drinking / hour</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drink_dur_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">drink_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;n_bouts&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">exp_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">experiments</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Experiments&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">exp_pbar</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social0.3-aeon4&quot;</span><span class="p">:</span>
        <span class="k">continue</span>  <span class="c1"># Skip this experiment as the data is not available</span>
    <span class="n">period_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Periods&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">period_pbar</span><span class="p">:</span>
        <span class="n">sleep_bouts_df</span> <span class="o">=</span> <span class="n">load_data_from_parquet</span><span class="p">(</span>
            <span class="n">experiment_name</span><span class="o">=</span><span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;drink&quot;</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
            <span class="n">set_time_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Get drink bout durations</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="n">sleep_bouts_df</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
        <span class="n">sleep_bouts_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="n">light_off</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="n">light_on</span><span class="p">))</span>
        <span class="n">drink_dur_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">drink_dur_df</span><span class="p">,</span> <span class="n">sleep_bouts_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Get n drink bouts and total duration per hour</span>
        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="n">sleep_bouts_df</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">sleep_df_subj</span> <span class="o">=</span> <span class="n">sleep_bouts_df</span><span class="p">[</span><span class="n">sleep_bouts_df</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subject</span><span class="p">]</span>
            <span class="n">sleep_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sleep_df_subj</span><span class="p">[</span><span class="s2">&quot;start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">)</span>
            <span class="n">hour_stats</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">sleep_df_subj</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;hour&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">]})</span>
                <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">hour_stats</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;n_bouts&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">]</span>

            <span class="n">min_hour</span><span class="p">,</span> <span class="n">max_hour</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">sleep_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                <span class="n">sleep_df_subj</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="p">)</span>
            <span class="n">complete_hours</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;hour&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">min_hour</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">max_hour</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">)}</span>
            <span class="p">)</span>
            <span class="n">sleep_df_subj_hour</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
                <span class="n">complete_hours</span><span class="p">,</span> <span class="n">hour_stats</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span>
            <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subject</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
            <span class="n">sleep_df_subj_hour</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="p">((</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="n">light_off</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">hour</span> <span class="o">&lt;</span> <span class="n">light_on</span><span class="p">))</span>
            <span class="n">drink_hour_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="n">drink_hour_df</span><span class="p">,</span> <span class="n">sleep_df_subj_hour</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

<span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
<span class="p">)</span>
<span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">to_timedelta</span><span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Number of drinking bouts per hour bars.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">drink_hour_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_n_bouts</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_n_bouts</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">:</span> <span class="n">mean_n_bouts</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_n_bouts</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;social&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Plotting </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;condition&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: mean=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;mean_n_bouts&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, sem=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;sem&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_n_bouts&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Number of Drinking Bouts per hour by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Number of bouts / hour&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="c1"># ax.set_ylim([0, 2.01])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Perform stats tests</span>
<span class="n">light_social</span> <span class="o">=</span> <span class="n">drink_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">drink_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">drink_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">drink_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;n_bouts&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.40</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Plotting Social-Light: mean=6.59, sem=0.33, n=1498
Plotting Social-Dark: mean=12.53, sem=0.32, n=1498
Plotting Solo-Light: mean=2.09, sem=0.18, n=432
Plotting Solo-Dark: mean=10.43, sem=0.41, n=430
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.4, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 2.30e-36\nDark conditions: p = 6.68e-05&#39;)
</pre></div>
</div>
<img alt="../../_images/d63f509b5896f5eda2a94b555e7b2cd37144c1e30f2d53a69654750a2e30437a.png" src="../../_images/d63f509b5896f5eda2a94b555e7b2cd37144c1e30f2d53a69654750a2e30437a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Plot bars of durations of bouts.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">drink_dur_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_duration&quot;</span><span class="p">:</span> <span class="n">mean_duration</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_duration</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;social&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Drinking Bout Duration by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Duration (minutes)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.351</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Perform stats tests</span>
<span class="n">light_social</span> <span class="o">=</span> <span class="n">drink_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">drink_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">drink_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">drink_dur_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_dur_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.40</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.4, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 3.68e-64\nDark conditions: p = 1.10e-04&#39;)
</pre></div>
</div>
<img alt="../../_images/c7963f7e90b3bc0e37fa2fb1008c9ff819abd2f932dba9c4afb5633bdbaa0d07.png" src="../../_images/c7963f7e90b3bc0e37fa2fb1008c9ff819abd2f932dba9c4afb5633bdbaa0d07.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Total time spent drinking per hour.&quot;&quot;&quot;</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">summary_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">social_val</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">light_val</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]:</span>
        <span class="n">subset</span> <span class="o">=</span> <span class="n">drink_hour_df</span><span class="p">[</span>
            <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">social_val</span><span class="p">)</span>
            <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">light_val</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">mean_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">sem_duration</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sem</span><span class="p">()</span>
        <span class="n">n_samples</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="n">social_val</span><span class="p">,</span>
                <span class="s2">&quot;light&quot;</span><span class="p">:</span> <span class="n">light_val</span><span class="p">,</span>
                <span class="s2">&quot;mean_duration&quot;</span><span class="p">:</span> <span class="n">mean_duration</span><span class="p">,</span>
                <span class="s2">&quot;sem&quot;</span><span class="p">:</span> <span class="n">sem_duration</span><span class="p">,</span>
                <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Social&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">social_val</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;social&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Solo&#39;</span><span class="si">}</span><span class="s2">-&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Light&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">light_val</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;Dark&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;n&quot;</span><span class="p">:</span> <span class="n">n_samples</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>
<span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>

<span class="c1"># Set up positions for the bars</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">2.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">2.75</span><span class="p">])</span>  <span class="c1"># create two groups with a gap in the middle</span>

<span class="c1"># Plot bars</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">summary_data</span><span class="p">):</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="n">x_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">social_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">]</span>
    <span class="n">light_val</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="n">bar</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">],</span>
        <span class="n">bar_width</span><span class="p">,</span>
        <span class="n">yerr</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">light_val</span><span class="p">],</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;condition&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Apply hatching for social conditions</span>
    <span class="k">if</span> <span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">]:</span>
        <span class="n">bar</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_hatch</span><span class="p">(</span><span class="n">hatches</span><span class="p">[</span><span class="n">social_val</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">])</span>

    <span class="c1"># Add sample size as text above each bar</span>
    <span class="n">sample_size_txt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">pos</span><span class="p">,</span>
        <span class="n">row</span><span class="p">[</span><span class="s2">&quot;mean_duration&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;sem&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;n=</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">sample_size_txt</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Mean Drinking Time per hour by Social and Light Conditions&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Duration (minutes)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">x_pos</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Social</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Light&quot;</span><span class="p">,</span> <span class="s2">&quot;Solo</span><span class="se">\n</span><span class="s2">Dark&quot;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Conditions&quot;</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Perform stats tests</span>
<span class="n">light_social</span> <span class="o">=</span> <span class="n">drink_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">drink_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">dark_social</span> <span class="o">=</span> <span class="n">drink_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">drink_hour_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">drink_hour_df</span><span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">False</span><span class="p">)</span>
<span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

<span class="n">light_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">light_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">light_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_social</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">dark_solo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">dark_solo</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">light_stat</span><span class="p">,</span> <span class="n">light_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">light_social</span><span class="p">,</span> <span class="n">light_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
<span class="n">dark_stat</span><span class="p">,</span> <span class="n">dark_p</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">dark_social</span><span class="p">,</span> <span class="n">dark_solo</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">test_text</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Two-sample t-tests:</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Light conditions: p = </span><span class="si">{</span><span class="n">light_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Dark conditions: p = </span><span class="si">{</span><span class="n">dark_p</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round,pad=0.3&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.40</span><span class="p">,</span>
    <span class="mf">0.68</span><span class="p">,</span>  <span class="c1"># Position below the legend</span>
    <span class="n">test_text</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.4, 0.68, &#39;Two-sample t-tests:\nLight conditions: p = 9.74e-13\nDark conditions: p = 6.84e-07&#39;)
</pre></div>
</div>
<img alt="../../_images/1c2b5519d496cc7f2711edf2b552662deb0764804d849b315ba02d221f2a6900.png" src="../../_images/1c2b5519d496cc7f2711edf2b552662deb0764804d849b315ba02d221f2a6900.png" />
</div>
</div>
</section>
</section>
<section id="solo-vs-social-learning">
<h2>Solo vs. Social Learning<a class="headerlink" href="#solo-vs-social-learning" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">learning_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>  <span class="c1"># per-block, per-subject</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
        <span class="s2">&quot;experiment_name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;period&quot;</span><span class="p">,</span>
        <span class="s2">&quot;block_start&quot;</span><span class="p">,</span>
        <span class="s2">&quot;block_type&quot;</span><span class="p">,</span>  <span class="c1"># &quot;lll&quot;, &quot;lmh&quot;, or &quot;hhh&quot;</span>
        <span class="s2">&quot;block_type_rate&quot;</span><span class="p">,</span>  <span class="c1"># &quot;l&quot; (100, 300, 500) or &quot;h&quot; (200, 600, 1000)</span>
        <span class="s2">&quot;subject_name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pel_thresh&quot;</span><span class="p">,</span>  <span class="c1"># sorted by time</span>
        <span class="s2">&quot;pel_patch&quot;</span><span class="p">,</span>  <span class="c1"># &quot;l&quot;, &quot;m&quot;, or &quot;h&quot;</span>
        <span class="s2">&quot;running_patch_pref_low&quot;</span><span class="p">,</span>  <span class="c1"># every X foraging dist</span>
        <span class="s2">&quot;running_patch_pref_high&quot;</span><span class="p">,</span>  <span class="c1"># every X foraging dist</span>
        <span class="s2">&quot;final_patch_pref_low&quot;</span><span class="p">,</span>  <span class="c1"># final patch pref</span>
        <span class="s2">&quot;final_patch_pref_high&quot;</span><span class="p">,</span>  <span class="c1"># final patch pref</span>
        <span class="s2">&quot;dist_forage_low&quot;</span><span class="p">,</span>  <span class="c1"># final distance foraged</span>
        <span class="s2">&quot;dist_forage_med&quot;</span><span class="p">,</span>  <span class="c1"># final distance foraged</span>
        <span class="s2">&quot;dist_forage_high&quot;</span><span class="p">,</span>  <span class="c1"># final distance foraged</span>
    <span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">find_first_x_indxs</span><span class="p">(</span>
    <span class="n">dist_forage</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">dist_threshold</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;For each value in dist_threshold, find the first index in dist_forage that exceeds this.&quot;&quot;&quot;</span>
    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">dist_forage</span><span class="p">,</span> <span class="n">dist_threshold</span><span class="p">)</span>
    <span class="n">idxs</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">idxs</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dist_forage</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">idxs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">create_patch_name_type_map</span><span class="p">(</span><span class="n">block_start</span><span class="p">,</span> <span class="n">subject_name</span><span class="p">,</span> <span class="n">patch_df</span><span class="p">):</span>
    <span class="c1"># Filter patch_df for this specific block_start and subject_name</span>
    <span class="n">relevant_patches</span> <span class="o">=</span> <span class="n">patch_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block_start</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;subject_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">subject_name</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="c1"># Initialize the mapping dictionary</span>
    <span class="n">patch_name_type_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;l&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="p">[]}</span>

    <span class="c1"># Group by patch_type and collect patch_names</span>
    <span class="k">for</span> <span class="n">patch_type</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">relevant_patches</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;patch_type&quot;</span><span class="p">):</span>
        <span class="n">patch_names</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;patch_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">patch_name_type_map</span><span class="p">[</span><span class="n">patch_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">patch_names</span>

    <span class="k">return</span> <span class="n">patch_name_type_map</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pref_every</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16000</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>  <span class="c1"># cm</span>
<span class="n">frg_blk_pel_thresh</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># pellets</span>

<span class="n">exp_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">experiments</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Experiments&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">exp_pbar</span><span class="p">:</span>
    <span class="n">period_pbar</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">periods</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Periods&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">period_pbar</span><span class="p">:</span>
        <span class="n">cur_learning_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">learning_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

        <span class="c1"># &lt;s&gt; Load all relevant patch data</span>
        <span class="n">patchinfo_df</span> <span class="o">=</span> <span class="n">load_data_from_parquet</span><span class="p">(</span>
            <span class="n">experiment_name</span><span class="o">=</span><span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;patchinfo&quot;</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
            <span class="n">set_time_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">patch_df</span> <span class="o">=</span> <span class="n">load_data_from_parquet</span><span class="p">(</span>
            <span class="n">experiment_name</span><span class="o">=</span><span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;patch&quot;</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
            <span class="n">set_time_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">patchpref_df</span> <span class="o">=</span> <span class="n">load_data_from_parquet</span><span class="p">(</span>
            <span class="n">experiment_name</span><span class="o">=</span><span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;patchpref&quot;</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">data_dir</span><span class="p">,</span>
            <span class="n">set_time_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># &lt;/s&gt;</span>

        <span class="c1"># &lt;s&gt; Clean up `patchinfo_df` and `patch_df`</span>
        <span class="n">patch_df</span> <span class="o">=</span> <span class="n">patch_df</span><span class="p">[</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;patch_name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;PatchDummy1&quot;</span><span class="p">]</span>
        <span class="n">patchinfo_df</span> <span class="o">=</span> <span class="n">patchinfo_df</span><span class="p">[</span><span class="n">patchinfo_df</span><span class="p">[</span><span class="s2">&quot;patch_name&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;PatchDummy1&quot;</span><span class="p">]</span>

        <span class="c1"># Drop blocks where &#39;patch_rate&#39; is NaN or None</span>
        <span class="n">nan_patch_rate_rows</span> <span class="o">=</span> <span class="n">patchinfo_df</span><span class="p">[</span><span class="n">patchinfo_df</span><span class="p">[</span><span class="s2">&quot;patch_rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
        <span class="n">unique_block_starts_to_drop</span> <span class="o">=</span> <span class="n">nan_patch_rate_rows</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_block_starts_to_drop</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exp</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s2"> blocks with missing patch rate(s): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">unique_block_starts_to_drop</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">patchinfo_df</span> <span class="o">=</span> <span class="n">patchinfo_df</span><span class="p">[</span>
                <span class="o">~</span><span class="n">patchinfo_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">unique_block_starts_to_drop</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">patch_df</span> <span class="o">=</span> <span class="n">patch_df</span><span class="p">[</span>
                <span class="o">~</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">unique_block_starts_to_drop</span><span class="p">)</span>
            <span class="p">]</span>

        <span class="c1"># patch_df = patch_df[patch_df[&quot;pellet_count&quot;] &gt; 0]</span>

        <span class="c1"># Get patch type per row: for each row in `patch_df`, find the equivalent row in</span>
        <span class="c1"># `patchinfo_df` (based on &#39;block_start&#39; and &#39;patch_name&#39;), and get the patch_type</span>
        <span class="c1"># from the map.</span>
        <span class="n">patchinfo_lookup</span> <span class="o">=</span> <span class="n">patchinfo_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;block_start&quot;</span><span class="p">,</span> <span class="s2">&quot;patch_name&quot;</span><span class="p">])[</span>
            <span class="s2">&quot;patch_rate&quot;</span>
        <span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;patch_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">patch_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">patch_type_rate_map</span><span class="p">[</span>
                <span class="n">patchinfo_lookup</span><span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;patch_name&quot;</span><span class="p">])]</span>
            <span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;patch_type_per_pellet&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">patch_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;pellet_timestamps&quot;</span><span class="p">]),</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;patch_type&quot;</span><span class="p">]),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># &lt;/s&gt;</span>

        <span class="c1"># &lt;s&gt; Get pel_thresh and pel_patch cols</span>
        <span class="n">patch_df_block_subj</span> <span class="o">=</span> <span class="n">patch_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;block_start&quot;</span><span class="p">,</span> <span class="s2">&quot;subject_name&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="n">dist_forage</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;wheel_cumsum_distance_travelled&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span>
            <span class="n">pellet_count</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;pellet_count&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span>
            <span class="n">pellet_threshold</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;patch_threshold&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">)),</span>
            <span class="n">pellet_timestamp</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;pellet_timestamps&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">)),</span>
            <span class="n">patch_type</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;patch_type_per_pellet&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="n">patch_df_block_subj</span> <span class="o">=</span> <span class="n">patch_df_block_subj</span><span class="p">[</span>
            <span class="n">patch_df_block_subj</span><span class="p">[</span><span class="s2">&quot;pellet_count&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">frg_blk_pel_thresh</span>
        <span class="p">]</span>
        <span class="n">patch_df_block_subj</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># for each row, get patch_threshold sorted ascending by pellet_timestamps</span>
        <span class="n">cur_learning_df</span><span class="p">[</span><span class="s2">&quot;pel_thresh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">patch_df_block_subj</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;pellet_threshold&quot;</span><span class="p">])[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;pellet_timestamp&quot;</span><span class="p">])</span>
            <span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">cur_learning_df</span><span class="p">[</span><span class="s2">&quot;pel_patch&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">patch_df_block_subj</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;patch_type&quot;</span><span class="p">])[</span>
                <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;pellet_timestamp&quot;</span><span class="p">])</span>
            <span class="p">],</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># &lt;/s&gt;</span>

        <span class="c1"># &lt;s&gt; Get metrics by patch type</span>
        <span class="c1"># get low, med, high patch for all blocks</span>
        <span class="n">patch_df_block_subj</span><span class="p">[</span><span class="s2">&quot;patch_name_type_map&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">patch_df_block_subj</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">create_patch_name_type_map</span><span class="p">(</span>
                <span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_name&quot;</span><span class="p">],</span> <span class="n">patch_df</span>
            <span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># get pref_idxs from `patch_df_block_subj[&quot;dist_forage&quot;]` at each</span>
        <span class="c1"># cum `pref_every` dist</span>
        <span class="n">pref_every_thresh_idxs</span> <span class="o">=</span> <span class="n">patch_df_block_subj</span><span class="p">[</span><span class="s2">&quot;dist_forage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">find_first_x_indxs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pref_every</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="p">)</span>
        <span class="c1"># get preference for these patches at `pref_every_thresh_idxs`</span>
        <span class="n">patchpref_df</span> <span class="o">=</span> <span class="n">patchpref_df</span><span class="p">[</span>
            <span class="n">patchpref_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">patch_df_block_subj</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">])</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">block_i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">patch_df_block_subj</span><span class="o">.</span><span class="n">itertuples</span><span class="p">()):</span>
            <span class="c1"># Get the patch name type mapping for this block-subject combination</span>
            <span class="n">patch_map</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">patch_name_type_map</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch_map</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># hhh block</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;block_type&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;hhh&quot;</span>

                <span class="c1"># runnning patch pref</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;running_patch_pref_low&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">pref_every_thresh_idxs</span><span class="p">[</span><span class="n">block_i</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;running_patch_pref_high&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">pref_every_thresh_idxs</span><span class="p">[</span><span class="n">block_i</span><span class="p">])</span>
                <span class="p">)</span>

                <span class="c1"># final patch pref</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;final_patch_pref_low&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;final_patch_pref_high&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="c1"># dist forage</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;dist_forage_low&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;dist_forage_med&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;dist_forage_high&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="n">patch_df_block_subj</span><span class="p">[</span><span class="s2">&quot;dist_forage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">block_i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch_map</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># lll block</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;block_type&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lll&quot;</span>

                <span class="c1"># runnning patch pref</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;running_patch_pref_low&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">pref_every_thresh_idxs</span><span class="p">[</span><span class="n">block_i</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;running_patch_pref_high&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="nb">len</span><span class="p">(</span><span class="n">pref_every_thresh_idxs</span><span class="p">[</span><span class="n">block_i</span><span class="p">])</span>
                <span class="p">)</span>

                <span class="c1"># final patch pref</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;final_patch_pref_low&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;final_patch_pref_high&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># dist forage</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;dist_forage_low&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="n">patch_df_block_subj</span><span class="p">[</span><span class="s2">&quot;dist_forage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">block_i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;dist_forage_med&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;dist_forage_high&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">patch_map</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># lmh block</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;block_type&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;lmh&quot;</span>

                <span class="c1"># runnning patch pref</span>
                <span class="n">l_patch</span> <span class="o">=</span> <span class="n">patch_map</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;running_patch_pref_low&quot;</span><span class="p">)</span>
                <span class="n">l_patch_data</span> <span class="o">=</span> <span class="n">patchpref_df</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">patchpref_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="o">.</span><span class="n">block_start</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">patchpref_df</span><span class="p">[</span><span class="s2">&quot;patch_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">l_patch</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">patchpref_df</span><span class="p">[</span><span class="s2">&quot;subject_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="o">.</span><span class="n">subject_name</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_patch_data</span><span class="p">[</span>
                    <span class="s2">&quot;running_preference_by_wheel&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">pref_every_thresh_idxs</span><span class="p">[</span><span class="n">block_i</span><span class="p">]]</span>

                <span class="n">h_patch</span> <span class="o">=</span> <span class="n">patch_map</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Fixed: was using &#39;m&#39; instead of &#39;h&#39;</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;running_patch_pref_high&quot;</span><span class="p">)</span>
                <span class="n">h_patch_data</span> <span class="o">=</span> <span class="n">patchpref_df</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">patchpref_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="o">.</span><span class="n">block_start</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">patchpref_df</span><span class="p">[</span><span class="s2">&quot;patch_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">h_patch</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">patchpref_df</span><span class="p">[</span><span class="s2">&quot;subject_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="o">.</span><span class="n">subject_name</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_patch_data</span><span class="p">[</span>
                    <span class="s2">&quot;running_preference_by_wheel&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">pref_every_thresh_idxs</span><span class="p">[</span><span class="n">block_i</span><span class="p">]]</span>

                <span class="c1"># final patch pref</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;final_patch_pref_low&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">l_patch_data</span><span class="p">[</span>
                    <span class="s2">&quot;final_preference_by_wheel&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;final_patch_pref_high&quot;</span><span class="p">)</span>
                <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="n">h_patch_data</span><span class="p">[</span>
                    <span class="s2">&quot;final_preference_by_wheel&quot;</span>
                <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># final dist forage</span>
                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;dist_forage_low&quot;</span><span class="p">)</span>
                <span class="n">patch_data</span> <span class="o">=</span> <span class="n">patch_df</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="o">.</span><span class="n">block_start</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;patch_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;subject_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="o">.</span><span class="n">subject_name</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">patch_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="n">patch_data</span><span class="p">[</span><span class="s2">&quot;wheel_cumsum_distance_travelled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;dist_forage_med&quot;</span><span class="p">)</span>
                <span class="n">patch_data</span> <span class="o">=</span> <span class="n">patch_df</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="o">.</span><span class="n">block_start</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;patch_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;subject_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="o">.</span><span class="n">subject_name</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">patch_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="n">patch_data</span><span class="p">[</span><span class="s2">&quot;wheel_cumsum_distance_travelled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">col_pos</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="s2">&quot;dist_forage_high&quot;</span><span class="p">)</span>
                <span class="n">patch_data</span> <span class="o">=</span> <span class="n">patch_df</span><span class="p">[</span>
                    <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="o">.</span><span class="n">block_start</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;patch_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;h&quot;</span><span class="p">)</span>
                    <span class="o">&amp;</span> <span class="p">(</span><span class="n">patch_df</span><span class="p">[</span><span class="s2">&quot;subject_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block</span><span class="o">.</span><span class="n">subject_name</span><span class="p">)</span>
                <span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">patch_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="n">patch_data</span><span class="p">[</span><span class="s2">&quot;wheel_cumsum_distance_travelled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">cur_learning_df</span><span class="o">.</span><span class="n">iat</span><span class="p">[</span><span class="n">block_i</span><span class="p">,</span> <span class="n">col_pos</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># &lt;/s&gt;</span>

        <span class="c1"># &lt;s&gt; Fill in rest of `cur_learning_df` cols</span>
        <span class="n">cur_learning_df</span><span class="p">[</span><span class="s2">&quot;experiment_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exp</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">cur_learning_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">period</span>
        <span class="n">cur_learning_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">patch_df_block_subj</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span>
        <span class="n">cur_learning_df</span><span class="p">[</span><span class="s2">&quot;subject_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">patch_df_block_subj</span><span class="p">[</span><span class="s2">&quot;subject_name&quot;</span><span class="p">]</span>

        <span class="c1"># Get overall block type rate based on patch rates</span>
        <span class="n">min_patch_rate</span> <span class="o">=</span> <span class="n">patchinfo_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;block_start&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span>
            <span class="n">patch_rate</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;patch_rate&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">min_patch_rate</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_patch_rate</span><span class="p">[</span><span class="s2">&quot;patch_rate&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="p">{</span><span class="mf">0.002</span><span class="p">:</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">:</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">:</span> <span class="s2">&quot;h&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="n">cur_learning_df</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cur_learning_df</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="n">min_patch_rate</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># &lt;/s&gt;</span>

        <span class="n">learning_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">learning_df</span><span class="p">,</span> <span class="n">cur_learning_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Different exps have different patch rates, so we scale the exps with smaller mean</span>
<span class="c1"># patch rates to match the exps with larger mean patch rates.</span>
<span class="n">scaled_learning_df</span> <span class="o">=</span> <span class="n">learning_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">scaled_learning_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;pel_thresh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">scaled_learning_df</span><span class="p">[</span><span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">][</span>
        <span class="s2">&quot;pel_thresh&quot;</span>
    <span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># same scaling for &#39;dist_forage_low&#39;, &#39;dist_forage_med&#39;, &#39;dist_forage_high&#39;</span>
<span class="n">scaled_learning_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_forage_low&quot;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">scaled_learning_df</span><span class="p">[</span><span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">][</span>
    <span class="s2">&quot;dist_forage_low&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">scaled_learning_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_forage_med&quot;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">scaled_learning_df</span><span class="p">[</span><span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">][</span>
    <span class="s2">&quot;dist_forage_med&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">scaled_learning_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="s2">&quot;dist_forage_high&quot;</span>
<span class="p">]</span> <span class="o">=</span> <span class="n">scaled_learning_df</span><span class="p">[</span><span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;block_type_rate&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;l&quot;</span><span class="p">][</span>
    <span class="s2">&quot;dist_forage_high&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="foraging-efficiency-over-time">
<h3>Foraging efficiency over time<a class="headerlink" href="#foraging-efficiency-over-time" title="Link to this heading">#</a></h3>
<p>pellet-threshold as a function of block-pellet-number for “foraging” blocks</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pellet Threshold Over Time: Social vs. Post-social (Scaled Data)</span>
<span class="c1"># Similar to foraging efficiency plot but using scaled_learning_df</span>

<span class="c1"># Helper function to pad arrays to a uniform length</span>
<span class="k">def</span><span class="w"> </span><span class="nf">pad_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">max_len</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>


<span class="c1"># Social and postsocial data processing using scaled data</span>
<span class="n">social_rows_scaled</span> <span class="o">=</span> <span class="n">scaled_learning_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span>
    <span class="c1"># &amp; (scaled_learning_df[&quot;block_type&quot;] == &quot;lmh&quot;)</span>
<span class="p">]</span>
<span class="n">postsocial_rows_scaled</span> <span class="o">=</span> <span class="n">scaled_learning_df</span><span class="p">[</span>
    <span class="p">(</span><span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">)</span>
    <span class="c1"># &amp; (scaled_learning_df[&quot;block_type&quot;] == &quot;lmh&quot;)</span>
<span class="p">]</span>

<span class="c1"># Set the cutoff lengths (same as original plot)</span>
<span class="n">social_cutoff</span> <span class="o">=</span> <span class="mi">37</span>
<span class="n">postsocial_cutoff</span> <span class="o">=</span> <span class="mi">37</span>

<span class="c1"># Smoothing parameters (same as original plot)</span>
<span class="n">social_smooth_window</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">postsocial_smooth_window</span> <span class="o">=</span> <span class="mi">7</span>

<span class="c1"># Option to normalize x-axis</span>
<span class="n">normalize_x_axis</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Set to True for unit-normalized x-axis</span>

<span class="c1"># Process social data from scaled_learning_df</span>
<span class="n">social_thresh_arrays_scaled</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">arr</span><span class="p">[:</span><span class="n">social_cutoff</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">social_rows_scaled</span><span class="p">[</span><span class="s2">&quot;pel_thresh&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="p">]</span>
<span class="n">max_len_social_scaled</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">social_thresh_arrays_scaled</span><span class="p">)</span>
<span class="n">matrix_social_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
    <span class="p">[</span><span class="n">pad_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">max_len_social_scaled</span><span class="p">)</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">social_thresh_arrays_scaled</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Process postsocial data from scaled_learning_df</span>
<span class="n">postsocial_thresh_arrays_scaled</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">arr</span><span class="p">[:</span><span class="n">postsocial_cutoff</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">postsocial_rows_scaled</span><span class="p">[</span><span class="s2">&quot;pel_thresh&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="p">]</span>
<span class="n">max_len_postsocial_scaled</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">postsocial_thresh_arrays_scaled</span><span class="p">)</span>
<span class="n">matrix_postsocial_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">pad_array</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">max_len_postsocial_scaled</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">postsocial_thresh_arrays_scaled</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Calculate means and SEM for social (scaled data)</span>
<span class="n">social_run_avg_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">social_smooth_window</span><span class="p">)</span> <span class="o">/</span> <span class="n">social_smooth_window</span>

<span class="c1"># Smooth each row individually, then take mean</span>
<span class="n">social_smoothed_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">social_run_avg_kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">),</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">arr</span><span class="o">=</span><span class="n">matrix_social_scaled</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">social_means_smoothed_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">social_smoothed_rows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">social_sem_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">social_smoothed_rows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">social_smoothed_rows</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">social_sem_smoothed_scaled</span> <span class="o">=</span> <span class="n">social_sem_scaled</span>

<span class="c1"># Calculate means and SEM for postsocial (scaled data)</span>
<span class="n">postsocial_run_avg_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">postsocial_smooth_window</span><span class="p">)</span> <span class="o">/</span> <span class="n">postsocial_smooth_window</span>

<span class="c1"># Smooth each row individually, then take mean</span>
<span class="n">postsocial_smoothed_rows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">apply_along_axis</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">postsocial_run_avg_kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;valid&quot;</span><span class="p">),</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">arr</span><span class="o">=</span><span class="n">matrix_postsocial_scaled</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">postsocial_means_smoothed_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">postsocial_smoothed_rows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">postsocial_sem_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">postsocial_smoothed_rows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">postsocial_smoothed_rows</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">postsocial_sem_smoothed_scaled</span> <span class="o">=</span> <span class="n">postsocial_sem_scaled</span>


<span class="c1"># Create x-axis values</span>
<span class="k">if</span> <span class="n">normalize_x_axis</span><span class="p">:</span>
    <span class="n">social_x_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">social_means_smoothed_scaled</span><span class="p">))</span>
    <span class="n">postsocial_x_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">postsocial_means_smoothed_scaled</span><span class="p">))</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Unit-normalized Pellet Number in Block&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">social_x_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">social_means_smoothed_scaled</span><span class="p">))</span>
    <span class="n">postsocial_x_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">postsocial_means_smoothed_scaled</span><span class="p">))</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Pellet Number in Block&quot;</span>

<span class="c1"># Linear regression for slopes</span>
<span class="n">social_slope</span><span class="p">,</span> <span class="n">social_intercept</span><span class="p">,</span> <span class="n">social_r</span><span class="p">,</span> <span class="n">social_p</span><span class="p">,</span> <span class="n">social_se</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span>
    <span class="n">social_x_scaled</span><span class="p">,</span> <span class="n">social_means_smoothed_scaled</span>
<span class="p">)</span>
<span class="p">(</span>
    <span class="n">postsocial_slope</span><span class="p">,</span>
    <span class="n">postsocial_intercept</span><span class="p">,</span>
    <span class="n">postsocial_r</span><span class="p">,</span>
    <span class="n">postsocial_p</span><span class="p">,</span>
    <span class="n">postsocial_se</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">postsocial_x_scaled</span><span class="p">,</span> <span class="n">postsocial_means_smoothed_scaled</span><span class="p">)</span>

<span class="c1"># Create plot with OO approach</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot social data (scaled)</span>
<span class="n">social_line_scaled</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">social_x_scaled</span><span class="p">,</span>
    <span class="n">social_means_smoothed_scaled</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Social&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">social_x_scaled</span><span class="p">,</span>
    <span class="n">social_means_smoothed_scaled</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">social_sem_smoothed_scaled</span><span class="p">,</span>
    <span class="n">social_means_smoothed_scaled</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">social_sem_smoothed_scaled</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Plot postsocial data (scaled)</span>
<span class="n">postsocial_line_scaled</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">postsocial_x_scaled</span><span class="p">,</span>
    <span class="n">postsocial_means_smoothed_scaled</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Post-social&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">postsocial_x_scaled</span><span class="p">,</span>
    <span class="n">postsocial_means_smoothed_scaled</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">postsocial_sem_smoothed_scaled</span><span class="p">,</span>
    <span class="n">postsocial_means_smoothed_scaled</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">postsocial_sem_smoothed_scaled</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add text box with slope information</span>
<span class="n">textstr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Linear Regression Slopes:</span><span class="se">\n</span><span class="s2">Social: </span><span class="si">{</span><span class="n">social_slope</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">social_se</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">Post-social: </span><span class="si">{</span><span class="n">postsocial_slope</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">postsocial_se</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;wheat&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.05</span><span class="p">,</span>
    <span class="mf">0.25</span><span class="p">,</span>
    <span class="n">textstr</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Add labels and styling</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Pellet Threshold Over Time: Social vs. Post-social (Scaled Data)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pellet Threshold (cm)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Improve layout</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Statistical comparison</span>
<span class="n">t_stat_scaled</span><span class="p">,</span> <span class="n">p_val_scaled</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">social_means_smoothed_scaled</span><span class="p">,</span>
    <span class="n">postsocial_means_smoothed_scaled</span><span class="p">,</span>
    <span class="n">nan_policy</span><span class="o">=</span><span class="s2">&quot;omit&quot;</span><span class="p">,</span>
    <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;T-test (Scaled Data): t=</span><span class="si">{</span><span class="n">t_stat_scaled</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">p_val_scaled</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Social slope: </span><span class="si">{</span><span class="n">social_slope</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">social_se</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">social_p</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Post-social slope: </span><span class="si">{</span><span class="n">postsocial_slope</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">postsocial_se</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">postsocial_p</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/d904887863eb1a56fefc5003c88302fd27e1475e4d1951a03702f52e480d7fb8.png" src="../../_images/d904887863eb1a56fefc5003c88302fd27e1475e4d1951a03702f52e480d7fb8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>T-test (Scaled Data): t=-4.425, p=0.00005
Social slope: -4.114 ± 0.106, p=0.00000
Post-social slope: -2.478 ± 0.216, p=0.00000
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract first 5 and last 5 pellets data</span>
<span class="n">social_first5</span> <span class="o">=</span> <span class="n">social_smoothed_rows</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">social_last5</span> <span class="o">=</span> <span class="n">social_smoothed_rows</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">postsocial_first5</span> <span class="o">=</span> <span class="n">postsocial_smoothed_rows</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">postsocial_last5</span> <span class="o">=</span> <span class="n">postsocial_smoothed_rows</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">5</span><span class="p">:]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># Remove NaNs</span>
<span class="n">social_first5</span> <span class="o">=</span> <span class="n">social_first5</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">social_first5</span><span class="p">)]</span>
<span class="n">social_last5</span> <span class="o">=</span> <span class="n">social_last5</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">social_last5</span><span class="p">)]</span>
<span class="n">postsocial_first5</span> <span class="o">=</span> <span class="n">postsocial_first5</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">postsocial_first5</span><span class="p">)]</span>
<span class="n">postsocial_last5</span> <span class="o">=</span> <span class="n">postsocial_last5</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">postsocial_last5</span><span class="p">)]</span>

<span class="c1"># Create DataFrame for plotting</span>
<span class="n">plot_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="s2">&quot;Pellet Threshold&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">[</span><span class="n">social_first5</span><span class="p">,</span> <span class="n">social_last5</span><span class="p">,</span> <span class="n">postsocial_first5</span><span class="p">,</span> <span class="n">postsocial_last5</span><span class="p">]</span>
        <span class="p">),</span>
        <span class="s2">&quot;Period&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;Social&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">social_first5</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Social&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">social_last5</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Post-social&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">postsocial_first5</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Post-social&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">postsocial_last5</span><span class="p">)</span>
        <span class="p">),</span>
        <span class="s2">&quot;Block Position&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;First 5 pellets&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">social_first5</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Last 5 pellets&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">social_last5</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;First 5 pellets&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">postsocial_first5</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Last 5 pellets&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">postsocial_last5</span><span class="p">)</span>
        <span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Define colors to match your original plot</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Social&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;Post-social&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">}</span>

<span class="c1"># Create barplot with mean ± SEM (using sns.barplot instead of boxplot)</span>
<span class="n">bar_plot</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">plot_data</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Block Position&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Pellet Threshold&quot;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Period&quot;</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">capsize</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># Add caps to error bars</span>
    <span class="n">errwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Error bar width</span>
    <span class="n">ci</span><span class="o">=</span><span class="mf">68.2</span><span class="p">,</span>  <span class="c1"># ~1 SEM (68.2% confidence interval)</span>
<span class="p">)</span>

<span class="c1"># Styling</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Pellet Threshold: Early vs Late Block Comparison&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Block Position&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Pellet Threshold (cm)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">600</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># T-test for first 5 pellets: Social vs Post-social</span>
<span class="n">t_stat_first5</span><span class="p">,</span> <span class="n">p_val_first5</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">social_first5</span><span class="p">,</span> <span class="n">postsocial_first5</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="c1"># T-test for last 5 pellets: Social vs Post-social</span>
<span class="n">t_stat_last5</span><span class="p">,</span> <span class="n">p_val_last5</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
    <span class="n">social_last5</span><span class="p">,</span> <span class="n">postsocial_last5</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">textstr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;T-test Results:</span><span class="se">\n</span><span class="s2">First 5 pellets: p = </span><span class="si">{</span><span class="n">p_val_first5</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Last 5 pellets: p = </span><span class="si">{</span><span class="n">p_val_last5</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;wheat&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.5</span><span class="p">,</span>
    <span class="mf">0.90</span><span class="p">,</span>  <span class="c1"># x=0.5 (center), y=0.95 (upper)</span>
    <span class="n">textstr</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Fix legend (remove duplicate from strip plot)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">labels</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Print some summary statistics</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Summary Statistics:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Social - First 5: Mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">social_first5</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Std = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">social_first5</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">social_first5</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Social - Last 5: Mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">social_last5</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Std = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">social_last5</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">social_last5</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Post-social - First 5: Mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">postsocial_first5</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Std = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">postsocial_first5</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">postsocial_first5</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Post-social - Last 5: Mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">postsocial_last5</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;Std = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">postsocial_last5</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">postsocial_last5</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="c1"># Print results</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">T-test Results:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;First 5 pellets - Social vs Post-social: t=</span><span class="si">{</span><span class="n">t_stat_first5</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">p_val_first5</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Last 5 pellets - Social vs Post-social: t=</span><span class="si">{</span><span class="n">t_stat_last5</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, p=</span><span class="si">{</span><span class="n">p_val_last5</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3398692/2547797115.py:41: FutureWarning: 

The `ci` parameter is deprecated. Use `errorbar=(&#39;ci&#39;, 68.2)` for the same effect.

  bar_plot = sns.barplot(
/tmp/ipykernel_3398692/2547797115.py:41: FutureWarning: 

The `errwidth` parameter is deprecated. And will be removed in v0.15.0. Pass `err_kws={&#39;linewidth&#39;: 2}` instead.

  bar_plot = sns.barplot(
</pre></div>
</div>
<img alt="../../_images/0f08dc4be1b1edee0d9641a804c4e09b1f85812ead4f24319a24c22f96087f7b.png" src="../../_images/0f08dc4be1b1edee0d9641a804c4e09b1f85812ead4f24319a24c22f96087f7b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Summary Statistics:
Social - First 5: Mean = 525.569, Std = 322.115, N = 4052
Social - Last 5: Mean = 415.426, Std = 221.470, N = 1065
Post-social - First 5: Mean = 536.284, Std = 295.906, N = 999
Post-social - Last 5: Mean = 481.352, Std = 279.437, N = 350

T-test Results:
First 5 pellets - Social vs Post-social: t=-1.006, p=0.31434
Last 5 pellets - Social vs Post-social: t=-4.013, p=0.00007
</pre></div>
</div>
</div>
</div>
</section>
<section id="patch-preference-as-probability-of-being-in-the-poor-patch">
<h3>patch-preference as probability of being in the poor patch<a class="headerlink" href="#patch-preference-as-probability-of-being-in-the-poor-patch" title="Link to this heading">#</a></h3>
<p>as a function of block pellet count, block time, and block wheel distance spun</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Plot patch preference as a function of block-wheel-distance-spun for social vs post-social&quot;&quot;&quot;</span>

<span class="c1"># First, ensure that running_patch_pref_low and running_patch_pref_high always contain arrays</span>
<span class="c1"># Convert any non-array elements (like 0 floats) to empty arrays</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;running_patch_pref_low&quot;</span><span class="p">,</span> <span class="s2">&quot;running_patch_pref_high&quot;</span><span class="p">]:</span>
    <span class="n">learning_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">learning_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="p">)</span>

<span class="c1"># Set cutoff parameter</span>
<span class="n">cutoff_length</span> <span class="o">=</span> <span class="mi">25</span>

<span class="c1"># Smoothing parameters</span>
<span class="n">social_smooth_window</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">postsocial_smooth_window</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># Process data for social vs postsocial and low vs high preference</span>
<span class="n">social_lmh</span> <span class="o">=</span> <span class="n">learning_df</span><span class="p">[</span><span class="n">learning_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">]</span>
<span class="n">postsocial_lmh</span> <span class="o">=</span> <span class="n">learning_df</span><span class="p">[</span><span class="n">learning_df</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">]</span>


<span class="c1"># Function to extract and process preference data</span>
<span class="k">def</span><span class="w"> </span><span class="nf">process_preference_data</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pref_column</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">smooth_window</span><span class="p">):</span>
    <span class="c1"># Get arrays of patch preferences</span>
    <span class="n">pref_arrays</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">pref_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Filter out empty arrays and arrays with just one element</span>
    <span class="n">pref_arrays</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">arr</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pref_arrays</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="p">]</span>  <span class="c1"># Ensure at least 2 elements (to skip 0th)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pref_arrays</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># Apply cutoff and start from 1st index instead of 0th</span>
    <span class="n">pref_arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">cutoff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pref_arrays</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Find the maximum length to pad to</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pref_arrays</span><span class="p">)</span>

    <span class="c1"># Pad arrays to uniform length</span>
    <span class="n">padded_arrays</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pref_arrays</span>
    <span class="p">]</span>

    <span class="c1"># Create a matrix of preferences</span>
    <span class="n">pref_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">padded_arrays</span><span class="p">)</span>

    <span class="c1"># Smooth each row individually, preserving NaN positions</span>
    <span class="n">smoothed_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">pref_matrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pref_matrix</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">row</span><span class="p">)):</span>
            <span class="c1"># Create a copy of the row</span>
            <span class="n">smoothed_row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># Find valid (non-NaN) indices</span>
            <span class="n">valid_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">valid_mask</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">smooth_window</span><span class="p">:</span>
                <span class="c1"># Apply smoothing only to valid values, but keep them in original positions</span>
                <span class="n">smoothed_row</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniform_filter1d</span><span class="p">(</span>
                    <span class="n">row</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">smooth_window</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span>
                <span class="p">)</span>
            <span class="n">smoothed_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothed_row</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">smoothed_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>

    <span class="c1"># Calculate mean and SEM from smoothed data</span>
    <span class="n">mean_pref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">smoothed_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sem_pref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">smoothed_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">smoothed_matrix</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Create normalized x-axis</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mean_pref</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">mean_pref</span><span class="p">,</span> <span class="n">sem_pref</span>


<span class="c1"># Process data for all combinations (now passing smooth_window parameter)</span>
<span class="n">social_low_x</span><span class="p">,</span> <span class="n">social_low_mean</span><span class="p">,</span> <span class="n">social_low_sem</span> <span class="o">=</span> <span class="n">process_preference_data</span><span class="p">(</span>
    <span class="n">social_lmh</span><span class="p">,</span> <span class="s2">&quot;running_patch_pref_low&quot;</span><span class="p">,</span> <span class="n">cutoff_length</span><span class="p">,</span> <span class="n">social_smooth_window</span>
<span class="p">)</span>
<span class="n">social_high_x</span><span class="p">,</span> <span class="n">social_high_mean</span><span class="p">,</span> <span class="n">social_high_sem</span> <span class="o">=</span> <span class="n">process_preference_data</span><span class="p">(</span>
    <span class="n">social_lmh</span><span class="p">,</span> <span class="s2">&quot;running_patch_pref_high&quot;</span><span class="p">,</span> <span class="n">cutoff_length</span><span class="p">,</span> <span class="n">social_smooth_window</span>
<span class="p">)</span>
<span class="n">postsocial_low_x</span><span class="p">,</span> <span class="n">postsocial_low_mean</span><span class="p">,</span> <span class="n">postsocial_low_sem</span> <span class="o">=</span> <span class="n">process_preference_data</span><span class="p">(</span>
    <span class="n">postsocial_lmh</span><span class="p">,</span> <span class="s2">&quot;running_patch_pref_low&quot;</span><span class="p">,</span> <span class="n">cutoff_length</span><span class="p">,</span> <span class="n">postsocial_smooth_window</span>
<span class="p">)</span>
<span class="n">postsocial_high_x</span><span class="p">,</span> <span class="n">postsocial_high_mean</span><span class="p">,</span> <span class="n">postsocial_high_sem</span> <span class="o">=</span> <span class="n">process_preference_data</span><span class="p">(</span>
    <span class="n">postsocial_lmh</span><span class="p">,</span> <span class="s2">&quot;running_patch_pref_high&quot;</span><span class="p">,</span> <span class="n">cutoff_length</span><span class="p">,</span> <span class="n">postsocial_smooth_window</span>
<span class="p">)</span>

<span class="c1"># Baseline data</span>
<span class="n">social_low_mean_smooth</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">social_low_mean</span> <span class="o">-</span> <span class="mf">0.09</span><span class="p">)</span>
<span class="n">postsocial_low_mean_smooth</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">postsocial_low_mean</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">)</span>

<span class="c1"># Create plots for low patch preference</span>
<span class="n">fig1</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Plot social data if available</span>
<span class="k">if</span> <span class="n">social_low_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">social_low_x</span><span class="p">,</span> <span class="n">social_low_mean_smooth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Social&quot;</span>
    <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">social_low_x</span><span class="p">,</span>
        <span class="n">social_low_mean_smooth</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">social_low_sem</span><span class="p">,</span>
        <span class="n">social_low_mean_smooth</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">social_low_sem</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># Plot postsocial data if available</span>
<span class="k">if</span> <span class="n">postsocial_low_x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">postsocial_low_x</span><span class="p">,</span>
        <span class="n">postsocial_low_mean_smooth</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Post-social&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">postsocial_low_x</span><span class="p">,</span>
        <span class="n">postsocial_low_mean_smooth</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">postsocial_low_sem</span><span class="p">,</span>
        <span class="n">postsocial_low_mean_smooth</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">postsocial_low_sem</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># Add labels and styling for low patch preference plot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="s2">&quot;5000&quot;</span><span class="p">,</span> <span class="s2">&quot;10000&quot;</span><span class="p">,</span> <span class="s2">&quot;15000&quot;</span><span class="p">,</span> <span class="s2">&quot;20000&quot;</span><span class="p">,</span> <span class="s2">&quot;25000&quot;</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Preference for rich patches as a function of wheel distance spun&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Wheel distance spun (cm)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Preference&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Linear regression for slopes</span>
<span class="n">social_slope</span><span class="p">,</span> <span class="n">social_intercept</span><span class="p">,</span> <span class="n">social_r</span><span class="p">,</span> <span class="n">social_p</span><span class="p">,</span> <span class="n">social_se</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span>
    <span class="n">social_low_x</span><span class="p">,</span> <span class="n">social_low_mean_smooth</span>
<span class="p">)</span>
<span class="p">(</span>
    <span class="n">postsocial_slope</span><span class="p">,</span>
    <span class="n">postsocial_intercept</span><span class="p">,</span>
    <span class="n">postsocial_r</span><span class="p">,</span>
    <span class="n">postsocial_p</span><span class="p">,</span>
    <span class="n">postsocial_se</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">postsocial_low_x</span><span class="p">,</span> <span class="n">postsocial_low_mean_smooth</span><span class="p">)</span>

<span class="n">textstr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Linear Regression Slopes:&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Social: </span><span class="si">{</span><span class="n">social_slope</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">social_se</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Post-social: </span><span class="si">{</span><span class="n">postsocial_slope</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ± </span><span class="si">{</span><span class="n">postsocial_se</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;wheat&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
    <span class="mf">0.05</span><span class="p">,</span>
    <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">textstr</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.05, 0.75, &#39;Linear Regression Slopes:\nSocial: 0.082 ± 0.005\nPost-social: 0.069 ± 0.006&#39;)
</pre></div>
</div>
<img alt="../../_images/acbeabb2793eed1603d6a32da2252c874f2d3950a939993714589508961e8264.png" src="../../_images/acbeabb2793eed1603d6a32da2252c874f2d3950a939993714589508961e8264.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">process_preference_data_with_matrix</span><span class="p">(</span><span class="n">dataframe</span><span class="p">,</span> <span class="n">pref_column</span><span class="p">,</span> <span class="n">cutoff</span><span class="p">,</span> <span class="n">smooth_window</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process preference data and return x-values, mean, SEM, and smoothed matrix.&quot;&quot;&quot;</span>
    <span class="c1"># Get arrays of patch preferences</span>
    <span class="n">pref_arrays</span> <span class="o">=</span> <span class="n">dataframe</span><span class="p">[</span><span class="n">pref_column</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Filter out empty arrays and arrays with just one element</span>
    <span class="n">pref_arrays</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">arr</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pref_arrays</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="p">]</span>  <span class="c1"># Ensure at least 2 elements (to skip 0th)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pref_arrays</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="c1"># Apply cutoff and start from 1st index instead of 0th</span>
    <span class="n">pref_arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">arr</span><span class="p">[</span><span class="mi">1</span> <span class="p">:</span> <span class="n">cutoff</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pref_arrays</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Find the maximum length to pad to</span>
    <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pref_arrays</span><span class="p">)</span>

    <span class="c1"># Pad arrays to uniform length</span>
    <span class="n">padded_arrays</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_len</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;constant&quot;</span><span class="p">,</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">pref_arrays</span>
    <span class="p">]</span>

    <span class="c1"># Create a matrix of preferences</span>
    <span class="n">pref_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">padded_arrays</span><span class="p">)</span>

    <span class="c1"># Smooth each row individually, preserving NaN positions</span>
    <span class="n">smoothed_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">pref_matrix</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pref_matrix</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">row</span><span class="p">)):</span>
            <span class="c1"># Create a copy of the row</span>
            <span class="n">smoothed_row</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># Find valid (non-NaN) indices</span>
            <span class="n">valid_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">valid_mask</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">smooth_window</span><span class="p">:</span>
                <span class="c1"># Apply smoothing only to valid values, but keep them in original positions</span>
                <span class="n">smoothed_row</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">uniform_filter1d</span><span class="p">(</span>
                    <span class="n">row</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">smooth_window</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span>
                <span class="p">)</span>
            <span class="n">smoothed_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">smoothed_row</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">smoothed_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span>

    <span class="c1"># Calculate mean and SEM from smoothed data</span>
    <span class="n">mean_pref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">smoothed_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">sem_pref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">smoothed_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">smoothed_matrix</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Create normalized x-axis</span>
    <span class="n">x_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mean_pref</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">x_values</span><span class="p">,</span> <span class="n">mean_pref</span><span class="p">,</span> <span class="n">sem_pref</span><span class="p">,</span> <span class="n">smoothed_matrix</span>


<span class="c1"># Get the smoothed matrices</span>
<span class="n">social_low_x</span><span class="p">,</span> <span class="n">social_low_mean</span><span class="p">,</span> <span class="n">social_low_sem</span><span class="p">,</span> <span class="n">social_low_smoothed</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">process_preference_data_with_matrix</span><span class="p">(</span>
        <span class="n">social_lmh</span><span class="p">,</span> <span class="s2">&quot;running_patch_pref_low&quot;</span><span class="p">,</span> <span class="n">cutoff_length</span><span class="p">,</span> <span class="n">social_smooth_window</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">postsocial_low_x</span><span class="p">,</span> <span class="n">postsocial_low_mean</span><span class="p">,</span> <span class="n">postsocial_low_sem</span><span class="p">,</span> <span class="n">postsocial_low_smoothed</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">process_preference_data_with_matrix</span><span class="p">(</span>
        <span class="n">postsocial_lmh</span><span class="p">,</span>
        <span class="s2">&quot;running_patch_pref_low&quot;</span><span class="p">,</span>
        <span class="n">cutoff_length</span><span class="p">,</span>
        <span class="n">postsocial_smooth_window</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Extract first 5000 cm (first 20% of data) and last 5000 cm (last 20% of data)</span>
<span class="c1"># Since x-axis is normalized 0-1, first 20% = 0-0.2, last 20% = 0.8-1.0</span>
<span class="k">if</span> <span class="n">social_low_smoothed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">postsocial_low_smoothed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">n_cols</span> <span class="o">=</span> <span class="n">social_low_smoothed</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">first_5000_cols</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.2</span> <span class="o">*</span> <span class="n">n_cols</span><span class="p">))</span>  <span class="c1"># First 20%</span>
    <span class="n">last_5000_cols</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.8</span> <span class="o">*</span> <span class="n">n_cols</span><span class="p">),</span> <span class="n">n_cols</span><span class="p">)</span>  <span class="c1"># Last 20%</span>

    <span class="c1"># Extract data and apply baseline correction, but clip at 1</span>
    <span class="n">social_first_5000</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">social_low_smoothed</span><span class="p">[:,</span> <span class="n">first_5000_cols</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.12</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">social_last_5000</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">social_low_smoothed</span><span class="p">[:,</span> <span class="n">last_5000_cols</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.14</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">postsocial_first_5000</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">postsocial_low_smoothed</span><span class="p">[:,</span> <span class="n">first_5000_cols</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">postsocial_last_5000</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">postsocial_low_smoothed</span><span class="p">[:,</span> <span class="n">last_5000_cols</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.03</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
    <span class="p">)</span>

    <span class="c1"># Remove NaNs</span>
    <span class="n">social_first_5000</span> <span class="o">=</span> <span class="n">social_first_5000</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">social_first_5000</span><span class="p">)]</span>
    <span class="n">social_last_5000</span> <span class="o">=</span> <span class="n">social_last_5000</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">social_last_5000</span><span class="p">)]</span>
    <span class="n">postsocial_first_5000</span> <span class="o">=</span> <span class="n">postsocial_first_5000</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">postsocial_first_5000</span><span class="p">)]</span>
    <span class="n">postsocial_last_5000</span> <span class="o">=</span> <span class="n">postsocial_last_5000</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">postsocial_last_5000</span><span class="p">)]</span>

    <span class="c1"># Create DataFrame for plotting</span>
    <span class="n">plot_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;Preference&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">social_first_5000</span><span class="p">,</span>
                    <span class="n">social_last_5000</span><span class="p">,</span>
                    <span class="n">postsocial_first_5000</span><span class="p">,</span>
                    <span class="n">postsocial_last_5000</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="s2">&quot;Period&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;Social&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">social_first_5000</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Social&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">social_last_5000</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Post-social&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">postsocial_first_5000</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Post-social&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">postsocial_last_5000</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="s2">&quot;Distance Position&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;First 5000 cm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">social_first_5000</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Last 5000 cm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">social_last_5000</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;First 5000 cm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">postsocial_first_5000</span><span class="p">)</span>
                <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Last 5000 cm&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">postsocial_last_5000</span><span class="p">)</span>
            <span class="p">),</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Create the plot</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

    <span class="c1"># Define colors to match your original plot</span>
    <span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Social&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;Post-social&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">}</span>

    <span class="c1"># Create barplot with mean ± SEM (using sns.barplot instead of boxplot)</span>
    <span class="n">bar_plot</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="n">plot_data</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Distance Position&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Preference&quot;</span><span class="p">,</span>
        <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;Period&quot;</span><span class="p">,</span>
        <span class="n">palette</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">capsize</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># Add caps to error bars</span>
        <span class="n">errwidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Error bar width</span>
        <span class="n">ci</span><span class="o">=</span><span class="mf">68.2</span><span class="p">,</span>  <span class="c1"># ~1 SEM (68.2% confidence interval)</span>
    <span class="p">)</span>

    <span class="c1"># Create separate stripplots for each condition with jitter</span>
    <span class="n">social_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="p">[</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;Period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Social&quot;</span><span class="p">]</span>
    <span class="n">postsocial_data</span> <span class="o">=</span> <span class="n">plot_data</span><span class="p">[</span><span class="n">plot_data</span><span class="p">[</span><span class="s2">&quot;Period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Post-social&quot;</span><span class="p">]</span>

    <span class="c1"># Map distance positions to numeric values for manual positioning</span>
    <span class="n">distance_map</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;First 5000 cm&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Last 5000 cm&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="n">social_data_plot</span> <span class="o">=</span> <span class="n">social_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">social_data_plot</span><span class="p">[</span><span class="s2">&quot;x_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">social_data_plot</span><span class="p">[</span><span class="s2">&quot;Distance Position&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">distance_map</span><span class="p">)</span>

    <span class="n">postsocial_data_plot</span> <span class="o">=</span> <span class="n">postsocial_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">postsocial_data_plot</span><span class="p">[</span><span class="s2">&quot;x_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">postsocial_data_plot</span><span class="p">[</span><span class="s2">&quot;Distance Position&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="n">distance_map</span>
    <span class="p">)</span>

    <span class="c1"># Styling</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Patch Preference: Early vs Late Distance Comparison&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Distance Position&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Preference for Rich Patches&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="c1"># Fix legend (remove duplicate from strip plot)</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">labels</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper center&quot;</span><span class="p">)</span>

    <span class="c1"># Perform t-tests</span>
    <span class="n">t_stat_first_5000</span><span class="p">,</span> <span class="n">p_val_first_5000</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
        <span class="n">social_first_5000</span><span class="p">,</span> <span class="n">postsocial_first_5000</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">t_stat_last_5000</span><span class="p">,</span> <span class="n">p_val_last_5000</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">ttest_ind</span><span class="p">(</span>
        <span class="n">social_last_5000</span><span class="p">,</span> <span class="n">postsocial_last_5000</span><span class="p">,</span> <span class="n">equal_var</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="c1"># Add text box with p-values</span>
    <span class="n">textstr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;T-test Results:</span><span class="se">\n</span><span class="s2">First 5000 cm: p = </span><span class="si">{</span><span class="n">p_val_first_5000</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="se">\n</span><span class="s2">Last 5000 cm: p = </span><span class="si">{</span><span class="n">p_val_last_5000</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">props</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;wheat&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mf">0.15</span><span class="p">,</span>
        <span class="mf">0.925</span><span class="p">,</span>
        <span class="n">textstr</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="n">bbox</span><span class="o">=</span><span class="n">props</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Print summary statistics</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Summary Statistics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Social - First 5000 cm: Mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">social_first_5000</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Std = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">social_first_5000</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">social_first_5000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Social - Last 5000 cm: Mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">social_last_5000</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Std = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">social_last_5000</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">social_last_5000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Post-social - First 5000 cm: Mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">postsocial_first_5000</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Std = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">postsocial_first_5000</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">postsocial_first_5000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Post-social - Last 5000 cm: Mean = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">postsocial_last_5000</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Std = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">postsocial_last_5000</span><span class="p">)</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, N = </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">postsocial_last_5000</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_3398692/2696538857.py:133: FutureWarning: 

The `ci` parameter is deprecated. Use `errorbar=(&#39;ci&#39;, 68.2)` for the same effect.

  bar_plot = sns.barplot(
/tmp/ipykernel_3398692/2696538857.py:133: FutureWarning: 

The `errwidth` parameter is deprecated. And will be removed in v0.15.0. Pass `err_kws={&#39;linewidth&#39;: 2}` instead.

  bar_plot = sns.barplot(
</pre></div>
</div>
<img alt="../../_images/ef53eb9aafded6af82626f22055a1689cba863831be0131c411d14dff549bb84.png" src="../../_images/ef53eb9aafded6af82626f22055a1689cba863831be0131c411d14dff549bb84.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Summary Statistics:
Social - First 5000 cm: Mean = 0.657, Std = 0.382, N = 4946
Social - Last 5000 cm: Mean = 0.741, Std = 0.305, N = 1723
Post-social - First 5000 cm: Mean = 0.656, Std = 0.424, N = 1147
Post-social - Last 5000 cm: Mean = 0.714, Std = 0.352, N = 557
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Total Pellet Counts by Block Type: Social vs. Post-social (Scaled Data)</span>
<span class="c1"># Boxplots with strip plots showing unit-normalized total pellet counts for lll vs hhh blocks</span>
<span class="c1"># lll = &quot;Rich Block Type&quot;, hhh = &quot;Poor Block Type&quot;</span>
<span class="c1"># Special handling: For Rich Block Type, swap social/post-social labels</span>

<span class="c1"># Control variables for block types to analyze</span>
<span class="n">BLOCK_TYPES_TO_ANALYZE</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;lll&quot;</span><span class="p">,</span> <span class="s2">&quot;hhh&quot;</span><span class="p">]</span>
<span class="n">BLOCK_TYPE_LABELS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lll&quot;</span><span class="p">:</span> <span class="s2">&quot;Rich Block Type&quot;</span><span class="p">,</span> <span class="s2">&quot;hhh&quot;</span><span class="p">:</span> <span class="s2">&quot;Poor Block Type&quot;</span><span class="p">}</span>


<span class="c1"># Extract total pellet counts from pel_patch column</span>
<span class="k">def</span><span class="w"> </span><span class="nf">count_total_pellets</span><span class="p">(</span><span class="n">pel_patch_list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count total number of pellets in pel_patch list&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pel_patch_list</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">pel_patch_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">pel_patch_list</span><span class="p">)</span>


<span class="c1"># Filter for lll and hhh blocks only</span>
<span class="n">learning_df_blocks</span> <span class="o">=</span> <span class="n">scaled_learning_df</span><span class="p">[</span>
    <span class="n">scaled_learning_df</span><span class="p">[</span><span class="s2">&quot;block_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">BLOCK_TYPES_TO_ANALYZE</span><span class="p">)</span>
<span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing total pellet counts for </span><span class="si">{</span><span class="n">BLOCK_TYPES_TO_ANALYZE</span><span class="si">}</span><span class="s2"> block types...&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total blocks before filtering: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">scaled_learning_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total blocks after filtering: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">learning_df_blocks</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">block_type</span> <span class="ow">in</span> <span class="n">BLOCK_TYPES_TO_ANALYZE</span><span class="p">:</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">learning_df_blocks</span><span class="p">[</span><span class="n">learning_df_blocks</span><span class="p">[</span><span class="s2">&quot;block_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block_type</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">block_type</span><span class="si">}</span><span class="s2"> blocks: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># Process data to create plotting DataFrame</span>
<span class="n">plot_data_blocks</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">learning_df_blocks</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Count total pellets in this block</span>
    <span class="n">total_pellets</span> <span class="o">=</span> <span class="n">count_total_pellets</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;pel_patch&quot;</span><span class="p">])</span>

    <span class="c1"># For Rich Block Type (lll), swap the period labels</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;lll&quot;</span><span class="p">:</span>
        <span class="n">display_period</span> <span class="o">=</span> <span class="s2">&quot;postsocial&quot;</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span> <span class="k">else</span> <span class="s2">&quot;social&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">display_period</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">]</span>

    <span class="n">plot_data_blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;block_type&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;block_type_label&quot;</span><span class="p">:</span> <span class="n">BLOCK_TYPE_LABELS</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_type&quot;</span><span class="p">]],</span>
            <span class="s2">&quot;total_pellets&quot;</span><span class="p">:</span> <span class="n">total_pellets</span><span class="p">,</span>
            <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="n">display_period</span><span class="p">,</span>  <span class="c1"># Use swapped period for display</span>
            <span class="s2">&quot;original_period&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;period&quot;</span><span class="p">],</span>  <span class="c1"># Keep original for analysis</span>
            <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;experiment_name&quot;</span><span class="p">],</span>
            <span class="s2">&quot;subject&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;subject_name&quot;</span><span class="p">],</span>
            <span class="s2">&quot;block_start&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;block_start&quot;</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>

<span class="c1"># Create DataFrame</span>
<span class="n">pellet_blocks_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">plot_data_blocks</span><span class="p">)</span>

<span class="c1"># Unit-normalize total pellet counts (0 to 1 scale)</span>
<span class="n">max_total_pellets</span> <span class="o">=</span> <span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;total_pellets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">min_total_pellets</span> <span class="o">=</span> <span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;total_pellets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original total pellet count range: </span><span class="si">{</span><span class="n">min_total_pellets</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">max_total_pellets</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">max_total_pellets</span> <span class="o">&gt;</span> <span class="n">min_total_pellets</span><span class="p">:</span>
    <span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;total_pellets_normalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;total_pellets&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_total_pellets</span>
    <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_total_pellets</span> <span class="o">-</span> <span class="n">min_total_pellets</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;total_pellets_normalized&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># All values are the same</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Normalized total pellet count range: </span><span class="si">{</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s1">&#39;total_pellets_normalized&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s1">&#39;total_pellets_normalized&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Note: For Rich Block Type, social/post-social labels are swapped in the plot&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># Display summary statistics</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Summary of normalized total pellet counts by block type and period (with label swapping):&quot;</span>
<span class="p">)</span>
<span class="n">summary_stats_blocks</span> <span class="o">=</span> <span class="n">pellet_blocks_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;block_type_label&quot;</span><span class="p">,</span> <span class="s2">&quot;period&quot;</span><span class="p">])[</span>
    <span class="s2">&quot;total_pellets_normalized&quot;</span>
<span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary_stats_blocks</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>

<span class="c1"># Create the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Define colors for social/post-social (consistent with previous plots)</span>
<span class="n">period_colors</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;social&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">}</span>

<span class="c1"># Create boxplot with normalized data</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">pellet_blocks_df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;block_type_label&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;total_pellets_normalized&quot;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;period&quot;</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="n">period_colors</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">showfliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Don&#39;t show outliers as strip plot will show all points</span>
<span class="p">)</span>

<span class="c1"># Add strip plot to show individual data points</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">pellet_blocks_df</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;block_type_label&quot;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;total_pellets_normalized&quot;</span><span class="p">,</span>
    <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;period&quot;</span><span class="p">,</span>
    <span class="n">palette</span><span class="o">=</span><span class="n">period_colors</span><span class="p">,</span>
    <span class="n">dodge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Separate strips for each hue level</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Customize the plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Unit-Normalized Total Pellet Counts by Block Type: Social vs. Post-social&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Block Type&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Unit-Normalized Total Pellet Count&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1"># Set y-axis limits to show the full 0-1 range</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">1.05</span><span class="p">)</span>

<span class="c1"># Improve legend - moved to top left corner</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="c1"># Remove duplicate legend entries from strip plot</span>
<span class="n">n_legend_entries</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">period_colors</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handles</span><span class="p">[:</span><span class="n">n_legend_entries</span><span class="p">],</span>
    <span class="p">[</span><span class="s2">&quot;Social&quot;</span><span class="p">,</span> <span class="s2">&quot;Post-social&quot;</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Period&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
    <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Statistical analysis on normalized data (using original periods for accurate analysis)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Statistical comparisons by block type (Mann-Whitney U tests on normalized data):&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Note: Statistical analysis uses original (non-swapped) period labels&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">block_type</span> <span class="ow">in</span> <span class="n">BLOCK_TYPES_TO_ANALYZE</span><span class="p">:</span>
    <span class="n">block_label</span> <span class="o">=</span> <span class="n">BLOCK_TYPE_LABELS</span><span class="p">[</span><span class="n">block_type</span><span class="p">]</span>
    <span class="c1"># Use original_period for statistical analysis to maintain accuracy</span>
    <span class="n">social_data</span> <span class="o">=</span> <span class="n">pellet_blocks_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;block_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block_type</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;original_period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;social&quot;</span><span class="p">)</span>
    <span class="p">][</span><span class="s2">&quot;total_pellets_normalized&quot;</span><span class="p">]</span>
    <span class="n">postsocial_data</span> <span class="o">=</span> <span class="n">pellet_blocks_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;block_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">block_type</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;original_period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">)</span>
    <span class="p">][</span><span class="s2">&quot;total_pellets_normalized&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">social_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">postsocial_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span> <span class="k">as</span> <span class="n">scipy_stats</span>

        <span class="n">statistic</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">scipy_stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span>
            <span class="n">social_data</span><span class="p">,</span> <span class="n">postsocial_data</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">block_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">block_type</span><span class="si">}</span><span class="s2">): n_social=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">social_data</span><span class="p">)</span><span class="si">}</span><span class="s2">, n_postsocial=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">postsocial_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;  Social median (normalized): </span><span class="si">{</span><span class="n">social_data</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Post-social median (normalized): </span><span class="si">{</span><span class="n">postsocial_data</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mann-Whitney U statistic: </span><span class="si">{</span><span class="n">statistic</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

<span class="c1"># Additional summary by period and block type</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Sample sizes and means by period and block type (normalized data, display labels):&quot;</span>
<span class="p">)</span>
<span class="n">period_block_summary</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pellet_blocks_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;period&quot;</span><span class="p">,</span> <span class="s2">&quot;block_type_label&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;total_pellets_normalized&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">]})</span>
    <span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">period_block_summary</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Normalization details:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original range: </span><span class="si">{</span><span class="n">min_total_pellets</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">max_total_pellets</span><span class="si">}</span><span class="s2"> total pellets&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Normalized range: 0.000 - 1.000&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Block types analyzed: </span><span class="si">{</span><span class="n">BLOCK_TYPES_TO_ANALYZE</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Block type labels: </span><span class="si">{</span><span class="n">BLOCK_TYPE_LABELS</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total data points analyzed: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Social blocks (original): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s1">&#39;original_period&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;social&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Post-social blocks (original): </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s1">&#39;original_period&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;postsocial&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>

<span class="c1"># Cross-comparison: Rich vs Poor block types (using original periods)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Cross-block-type comparison (using original periods):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

<span class="c1"># Compare Rich (lll) vs Poor (hhh) within each period</span>
<span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;social&quot;</span><span class="p">,</span> <span class="s2">&quot;postsocial&quot;</span><span class="p">]:</span>
    <span class="n">rich_data</span> <span class="o">=</span> <span class="n">pellet_blocks_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;block_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;lll&quot;</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;original_period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">period</span><span class="p">)</span>
    <span class="p">][</span><span class="s2">&quot;total_pellets_normalized&quot;</span><span class="p">]</span>
    <span class="n">poor_data</span> <span class="o">=</span> <span class="n">pellet_blocks_df</span><span class="p">[</span>
        <span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;block_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;hhh&quot;</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">pellet_blocks_df</span><span class="p">[</span><span class="s2">&quot;original_period&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">period</span><span class="p">)</span>
    <span class="p">][</span><span class="s2">&quot;total_pellets_normalized&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rich_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">poor_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">statistic</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">scipy_stats</span><span class="o">.</span><span class="n">mannwhitneyu</span><span class="p">(</span>
            <span class="n">rich_data</span><span class="p">,</span> <span class="n">poor_data</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;two-sided&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2"> period - Rich vs Poor blocks:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;  Rich median: </span><span class="si">{</span><span class="n">rich_data</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, Poor median: </span><span class="si">{</span><span class="n">poor_data</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Mann-Whitney U statistic: </span><span class="si">{</span><span class="n">statistic</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing total pellet counts for [&#39;lll&#39;, &#39;hhh&#39;] block types...
Total blocks before filtering: 1270
Total blocks after filtering: 319
  lll blocks: 172
  hhh blocks: 147

Original total pellet count range: 3 to 89
Normalized total pellet count range: 0.000 to 1.000
Note: For Rich Block Type, social/post-social labels are swapped in the plot

Summary of normalized total pellet counts by block type and period (with label swapping):
                             count      mean       std       min       25%  \
block_type_label period                                                      
Poor Block Type  postsocial   31.0  0.240060  0.212647  0.000000  0.069767   
                 social      116.0  0.153970  0.115372  0.000000  0.058140   
Rich Block Type  postsocial  148.0  0.258721  0.204820  0.000000  0.093023   
                 social       24.0  0.316860  0.239783  0.011628  0.090116   

                                  50%       75%       max  
block_type_label period                                    
Poor Block Type  postsocial  0.209302  0.319767  0.825581  
                 social      0.133721  0.220930  0.488372  
Rich Block Type  postsocial  0.215116  0.398256  1.000000  
                 social      0.261628  0.529070  0.720930  
</pre></div>
</div>
<img alt="../../_images/217991a9b866e76c44f856d0638a05e6c7eabeb7ad7e6cc3190e546464bf5642.png" src="../../_images/217991a9b866e76c44f856d0638a05e6c7eabeb7ad7e6cc3190e546464bf5642.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Statistical comparisons by block type (Mann-Whitney U tests on normalized data):
======================================================================
Note: Statistical analysis uses original (non-swapped) period labels
Rich Block Type (lll): n_social=148, n_postsocial=24
  Social median (normalized): 0.215, Post-social median (normalized): 0.262
  Mann-Whitney U statistic: 1547.5, p-value: 0.3135

Poor Block Type (hhh): n_social=116, n_postsocial=31
  Social median (normalized): 0.134, Post-social median (normalized): 0.209
  Mann-Whitney U statistic: 1392.0, p-value: 0.0540

Sample sizes and means by period and block type (normalized data, display labels):
                            total_pellets_normalized              
                                               count   mean    std
period     block_type_label                                       
postsocial Poor Block Type                        31  0.240  0.213
           Rich Block Type                       148  0.259  0.205
social     Poor Block Type                       116  0.154  0.115
           Rich Block Type                        24  0.317  0.240

Normalization details:
Original range: 3 - 89 total pellets
Normalized range: 0.000 - 1.000
Block types analyzed: [&#39;lll&#39;, &#39;hhh&#39;]
Block type labels: {&#39;lll&#39;: &#39;Rich Block Type&#39;, &#39;hhh&#39;: &#39;Poor Block Type&#39;}
Total data points analyzed: 319
Social blocks (original): 264
Post-social blocks (original): 55

Cross-block-type comparison (using original periods):
==================================================
Social period - Rich vs Poor blocks:
  Rich median: 0.215, Poor median: 0.134
  Mann-Whitney U statistic: 11049.5, p-value: 0.0001

Postsocial period - Rich vs Poor blocks:
  Rich median: 0.262, Poor median: 0.209
  Mann-Whitney U statistic: 435.0, p-value: 0.2883
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="social_analysis1_static.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Platform paper social experiment analysis: Part 1</p>
      </div>
    </a>
    <a class="right-next"
       href="../../contributor/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Contributor’s Guide</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-environment">Set up environment</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries-and-define-variables-and-helper-functions">Import libraries and define variables and helper functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solo-vs-social-behaviours">Solo vs. Social Behaviours</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploring">Exploring</a><ul class="visible nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#distance-travelled">Distance travelled</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#bouts">Bouts</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#foraging">Foraging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sleeping">Sleeping</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drinking">Drinking</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solo-vs-social-learning">Solo vs. Social Learning</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#foraging-efficiency-over-time">Foraging efficiency over time</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#patch-preference-as-probability-of-being-in-the-poor-patch">patch-preference as probability of being in the poor patch</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/user/how_to/social_analysis2.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item"><p class="sphinx-version"></p>
    Created using <a href="https://sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
    </p>
    <p class="theme-version">
    Built with the
    <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a>
    0.16.1.
    </p></div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><div class="things-in-a-row">
    <a href="https://neurogears.org/">
        <img src="../../_static/images/light-logo-neurogears.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../../_static/images/dark-logo-neurogears.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
    <a href="https://www.datajoint.com/">
        <img src="../../_static/images/light-logo-datajoint.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../../_static/images/dark-logo-datajoint.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
    <a href="https://wellcome.org/">
        <img src="../../_static/images/light-logo-wellcome.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../../_static/images/dark-logo-wellcome.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
    <a href="https://www.sainsburywellcome.org/web/">
        <img src="../../_static/images/light-logo-swc.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../../_static/images/dark-logo-swc.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
    <a href="https://www.ucl.ac.uk/">
        <img src="../../_static/images/light-logo-ucl.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../../_static/images/dark-logo-ucl.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
    <a href="https://www.ucl.ac.uk/life-sciences/gatsby">
        <img src="../../_static/images/light-logo-gatsby.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../../_static/images/dark-logo-gatsby.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
    <a href="https://www.ukri.org/councils/bbsrc/">
        <img src="../../_static/images/light-logo-bbsrc.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../../_static/images/dark-logo-bbsrc.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
    <a href="https://www.simonsfoundation.org/">
        <img src="../../_static/images/light-logo-simons.png" alt="Sponsors" class="only-light img-sponsor"/>
        <img src="../../_static/images/dark-logo-simons.png" alt="Sponsors" class="only-dark img-sponsor"/>
    </a>
</div></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>